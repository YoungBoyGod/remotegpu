# B3 - K8s Pod 管理完成任务

## 👤 员工信息

**员工编号**: B3
**负责模块**: K8s Pod 管理
**优先级**: P0
**预估工时**: 12 小时
**开始日期**: 2026-01-31（可与 B1 并行）
**预计完成**: 2026-02-02

---

## 📋 任务背景

### 当前状态
- ✅ K8s 客户端封装已完成
- ✅ 配置管理已完成
- ❌ Pod 管理功能缺失（创建、删除、查询）
- ❌ Pod 日志获取缺失
- ❌ Pod 状态监控缺失

### 依赖关系
- **无前置依赖**: 可以立即开始
- **阻塞 B4**: Service 管理需要 Pod 管理
- **阻塞 B6**: 环境创建需要 Pod 管理

---

## 🎯 交付目标

### 必须交付
- [ ] Pod 创建功能（支持 GPU、资源限制）
- [ ] Pod 查询和删除功能
- [ ] Pod 日志获取功能
- [ ] Pod 状态监控功能
- [ ] 单元测试和集成测试

---

## 📝 详细任务清单

### Task B3.1: 实现 Pod 管理 (8h)

#### 子任务

**B3.1.1 CreatePod** (3h)
- [ ] 创建 `pkg/k8s/pod.go`
- [ ] 定义 PodConfig 结构体（Name, Image, Command, Args, Resources, Env, Volumes, GPU）
- [ ] 实现 `CreatePod(config *PodConfig) (*corev1.Pod, error)`
- [ ] 支持 GPU 配置（nvidia.com/gpu）
- [ ] 支持资源限制（CPU, Memory）
- [ ] 支持环境变量和卷挂载

**B3.1.2 GetPod 和 DeletePod** (2h)
- [ ] 实现 `GetPod(namespace, name string) (*corev1.Pod, error)`
- [ ] 实现 `GetPodStatus(namespace, name string) (string, error)`
- [ ] 实现 `DeletePod(namespace, name string) error`
- [ ] 实现 `DeletePodGracefully(namespace, name string, gracePeriod int64) error`

**B3.1.3 GetPodLogs** (1.5h)
- [ ] 实现 `GetPodLogs(namespace, name string, opts *LogOptions) (string, error)`
- [ ] 支持 TailLines、Follow、Timestamps 选项
- [ ] 处理多容器场景

**B3.1.4 WatchPodStatus** (1.5h)
- [ ] 实现 `WatchPodStatus(namespace, name string, callback func(status string)) error`
- [ ] 使用 K8s Watch API
- [ ] 处理连接断开和重连
- [ ] 添加超时机制

---

### Task B3.2: 测试 (4h)

#### 子任务
- [ ] 编写单元测试（使用 fake clientset）
- [ ] 编写集成测试（需要 K8s 测试环境）
- [ ] 测试 GPU Pod 创建
- [ ] 测试并发创建
- [ ] 测试错误处理

#### 测试环境
```bash
# 启动测试集群
minikube start

# 运行集成测试
go test -v ./pkg/k8s -tags=integration
```

---

## ✅ 完成检查清单

- [ ] Pod 创建功能完成
- [ ] Pod 查询和删除功能完成
- [ ] 日志获取功能完成
- [ ] 状态监控功能完成
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试通过
- [ ] 已通知 B4 和 B6

---

**文档版本**: v1.0
**创建时间**: 2026-01-30
