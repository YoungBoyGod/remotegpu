# RemoteGPU é¡¹ç›®å®Œæ•´å®ç°æŒ‡å— - ä»0åˆ°1

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¶é—´**: 2026-02-01
> **é¡¹ç›®çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ,æŒç»­è¿­ä»£ä¸­
> **é€‚ç”¨å¯¹è±¡**: å¼€å‘è€…ã€è¿ç»´äººå‘˜ã€é¡¹ç›®ç®¡ç†è€…

---

## ğŸ“‹ æ–‡æ¡£ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆå’Œæ¶æ„](#2-æŠ€æœ¯æ ˆå’Œæ¶æ„)
3. [é¡¹ç›®ç»“æ„](#3-é¡¹ç›®ç»“æ„)
4. [å·²å®ç°åŠŸèƒ½æ¸…å•](#4-å·²å®ç°åŠŸèƒ½æ¸…å•)
5. [ä»0åˆ°1å®æ–½æ­¥éª¤](#5-ä»0åˆ°1å®æ–½æ­¥éª¤)
6. [æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
7. [æ ¸å¿ƒæ¨¡å—å®ç°](#7-æ ¸å¿ƒæ¨¡å—å®ç°)
8. [éƒ¨ç½²å’Œè¿ç»´](#8-éƒ¨ç½²å’Œè¿ç»´)
9. [å¼€å‘è§„èŒƒ](#9-å¼€å‘è§„èŒƒ)
10. [é—®é¢˜æ’æŸ¥](#10-é—®é¢˜æ’æŸ¥)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

**RemoteGPU** æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿçš„ GPU èµ„æºç®¡ç†å’Œç¯å¢ƒç¼–æ’å¹³å°,æ—¨åœ¨ä¸ºç”¨æˆ·æä¾›:

- ğŸ–¥ï¸ **æŒ‰éœ€åˆ†é…** GPU è®¡ç®—èµ„æº
- ğŸ³ **å®¹å™¨åŒ–ç¯å¢ƒ** å¿«é€Ÿåˆ›å»ºå’Œç®¡ç†
- ğŸ“Š **èµ„æºé…é¢** çµæ´»çš„é…é¢ç®¡ç†
- ğŸ” **å®‰å…¨è®¿é—®** å¤šç§è¿œç¨‹è®¿é—®æ–¹å¼
- ğŸ“ˆ **ç›‘æ§å‘Šè­¦** å®æ—¶èµ„æºç›‘æ§

### 1.2 æ ¸å¿ƒåŠŸèƒ½

1. **ç”¨æˆ·ç®¡ç†**: æ³¨å†Œã€ç™»å½•ã€æƒé™æ§åˆ¶
2. **èµ„æºç®¡ç†**: ä¸»æœºã€GPU èµ„æºçš„æ³¨å†Œå’Œåˆ†é…
3. **ç¯å¢ƒç®¡ç†**: å®¹å™¨åŒ–ç¯å¢ƒçš„åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤
4. **é…é¢ç®¡ç†**: ç”¨æˆ·çº§åˆ«çš„èµ„æºé…é¢æ§åˆ¶
5. **è¿œç¨‹è®¿é—®**: SSHã€RDPã€VNCã€Jupyter ç­‰å¤šç§è®¿é—®æ–¹å¼
6. **K8s é›†æˆ**: åŸºäº Kubernetes çš„å®¹å™¨ç¼–æ’

### 1.3 é¡¹ç›®ç›®æ ‡

- âœ… æä¾›ç®€å•æ˜“ç”¨çš„ GPU èµ„æºç®¡ç†å¹³å°
- âœ… æ”¯æŒå¤šç§éƒ¨ç½²æ¨¡å¼(K8sã€Dockerã€VM)
- âœ… å®ç°èµ„æºçš„é«˜æ•ˆåˆ©ç”¨å’Œå…¬å¹³åˆ†é…
- âœ… æä¾›å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

---

## 2. æŠ€æœ¯æ ˆå’Œæ¶æ„

### 2.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Go | 1.21+ | ä¸»è¦å¼€å‘è¯­è¨€ |
| Gin | v1.9+ | Web æ¡†æ¶ |
| GORM | v1.25+ | ORM æ¡†æ¶ |
| PostgreSQL | 17.7 | ä¸»æ•°æ®åº“ |
| Redis | 7.0+ | ç¼“å­˜å’Œä¼šè¯ |
| Kubernetes | 1.28+ | å®¹å™¨ç¼–æ’ |
| Docker | 24.0+ | å®¹å™¨è¿è¡Œæ—¶ |

### 2.2 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway                         â”‚
â”‚                    (Gin Framework)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller    â”‚  â”‚ Middleware  â”‚  â”‚    Router       â”‚
â”‚  (API Layer)   â”‚  â”‚  (Auth/Log) â”‚  â”‚  (URL Mapping)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Service Layer (Business Logic)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   User   â”‚ â”‚   Host   â”‚ â”‚   GPU    â”‚ â”‚   Env    â”‚ â”‚
â”‚  â”‚ Service  â”‚ â”‚ Service  â”‚ â”‚ Service  â”‚ â”‚ Service  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DAO Layer (Data Access)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ User DAO â”‚ â”‚ Host DAO â”‚ â”‚ GPU DAO  â”‚ â”‚ Env DAO  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Database Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ PostgreSQL   â”‚              â”‚    Redis     â”‚       â”‚
â”‚  â”‚  (ä¸»æ•°æ®åº“)   â”‚              â”‚   (ç¼“å­˜)      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¨¡å—åŒ–è®¾è®¡

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡,æ ¸å¿ƒæ¨¡å—åŒ…æ‹¬:

- **pkg/**: å¯å¤ç”¨çš„åŸºç¡€åŒ…
  - `cache`: ç¼“å­˜ç®¡ç†(Redis/Memory)
  - `database`: æ•°æ®åº“è¿æ¥å’Œè¿ç§»
  - `k8s`: Kubernetes å®¢æˆ·ç«¯å°è£…
  - `host`: ä¸»æœºé€‰æ‹©å’Œå¥åº·æ£€æŸ¥
  - `network`: ç½‘ç»œå’Œç«¯å£ç®¡ç†
  - `volume`: å­˜å‚¨å·ç®¡ç†
  - `deployment`: éƒ¨ç½²ç®¡ç†
  - `security`: å®‰å…¨å’Œè®¤è¯

---

## 3. é¡¹ç›®ç»“æ„

### 3.1 ç›®å½•ç»“æ„

```
remotegpu/backend/
â”œâ”€â”€ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â””â”€â”€ main.go            # ä¸»ç¨‹åº
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.yaml        # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ internal/              # å†…éƒ¨ä»£ç (ä¸å¯¹å¤–æš´éœ²)
â”‚   â”œâ”€â”€ controller/        # API æ§åˆ¶å™¨å±‚
â”‚   â”‚   â””â”€â”€ v1/           # API v1 ç‰ˆæœ¬
â”‚   â”œâ”€â”€ dao/              # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ entity/       # å®ä½“å®šä¹‰
â”‚   â”œâ”€â”€ router/           # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ service/          # ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ pkg/                   # å¯å¤ç”¨çš„å…¬å…±åŒ…
â”‚   â”œâ”€â”€ cache/            # ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ database/         # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ deployment/       # éƒ¨ç½²ç®¡ç†
â”‚   â”œâ”€â”€ host/             # ä¸»æœºç®¡ç†
â”‚   â”œâ”€â”€ k8s/              # K8s å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ network/          # ç½‘ç»œç®¡ç†
â”‚   â”œâ”€â”€ security/         # å®‰å…¨è®¤è¯
â”‚   â””â”€â”€ volume/           # å­˜å‚¨ç®¡ç†
â”œâ”€â”€ migrations/           # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ sql/                  # SQL åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ k8s/                  # K8s é…ç½®æ–‡ä»¶
```

### 3.2 æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|----------|------|
| `cmd/main.go` | åº”ç”¨ç¨‹åºå…¥å£,åˆå§‹åŒ–å„ä¸ªæ¨¡å— |
| `config/config.yaml` | é…ç½®æ–‡ä»¶,åŒ…å«æ•°æ®åº“ã€Redisã€JWTç­‰é…ç½® |
| `internal/router/router.go` | è·¯ç”±é…ç½®,å®šä¹‰æ‰€æœ‰APIç«¯ç‚¹ |
| `internal/middleware/` | ä¸­é—´ä»¶,åŒ…æ‹¬è®¤è¯ã€æ—¥å¿—ã€CORSç­‰ |
| `pkg/database/database.go` | æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ– |
| `pkg/k8s/client.go` | Kubernetes å®¢æˆ·ç«¯å°è£… |
| `migrations/` | æ•°æ®åº“è¿ç§»è„šæœ¬,è®°å½•æ•°æ®åº“ç»“æ„å˜æ›´ |

---

## 4. å·²å®ç°åŠŸèƒ½æ¸…å•

### 4.1 ç”¨æˆ·ç®¡ç†æ¨¡å— âœ…

**å®Œæˆåº¦**: 90%

#### å®ä½“å±‚
- âœ… User å®ä½“æ¨¡å‹ (`internal/model/entity/user.go`)
- âœ… å­—æ®µ: ID, Username, Email, Password, Role, Status

#### æ•°æ®è®¿é—®å±‚
- âœ… UserDao - å®Œæ•´çš„ CRUD æ“ä½œ
- âœ… æŒ‰ç”¨æˆ·å/é‚®ç®±æŸ¥è¯¢
- âœ… åˆ†é¡µåˆ—è¡¨æŸ¥è¯¢
- âœ… çŠ¶æ€ç®¡ç†

#### ä¸šåŠ¡é€»è¾‘å±‚
- âœ… UserService - ç”¨æˆ·æ³¨å†Œã€ç™»å½•
- âœ… JWT Token ç”Ÿæˆå’ŒéªŒè¯
- âœ… å¯†ç åŠ å¯†(bcrypt)
- âœ… ç”¨æˆ·ä¿¡æ¯è·å–å’Œæ›´æ–°

#### API å±‚
- âœ… POST `/api/v1/users/register` - ç”¨æˆ·æ³¨å†Œ
- âœ… POST `/api/v1/users/login` - ç”¨æˆ·ç™»å½•
- âœ… GET `/api/v1/users/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- âœ… PUT `/api/v1/users/me` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

### 4.2 èµ„æºç®¡ç†æ¨¡å— âœ…

**å®Œæˆåº¦**: 85%

#### ä¸»æœºç®¡ç†
- âœ… Host å®ä½“æ¨¡å‹ (`internal/model/entity/host.go`)
- âœ… HostDao - CRUDã€çŠ¶æ€ç®¡ç†ã€å¿ƒè·³æ›´æ–°
- âœ… HostService - ä¸»æœºæ³¨å†Œã€å¿ƒè·³ã€èµ„æºç»Ÿè®¡
- âœ… ä¸»æœºé€‰æ‹©ç­–ç•¥ (`pkg/host/selector.go`)
- âœ… å¥åº·æ£€æŸ¥æœºåˆ¶ (`pkg/host/health_checker.go`)

**API ç«¯ç‚¹**:
- âœ… POST `/api/v1/hosts` - æ³¨å†Œä¸»æœº
- âœ… GET `/api/v1/hosts` - åˆ—å‡ºä¸»æœº
- âœ… GET `/api/v1/hosts/:id` - è·å–ä¸»æœºè¯¦æƒ…
- âœ… PUT `/api/v1/hosts/:id` - æ›´æ–°ä¸»æœº
- âœ… POST `/api/v1/hosts/:id/heartbeat` - å¿ƒè·³ä¸ŠæŠ¥

#### GPU ç®¡ç†
- âœ… GPU å®ä½“æ¨¡å‹ (`internal/model/entity/gpu.go`)
- âœ… GPUDao - CRUDã€çŠ¶æ€ç®¡ç†ã€åˆ†é…/é‡Šæ”¾
- âœ… GPUService - GPU æ³¨å†Œã€åˆ†é…ã€é‡Šæ”¾
- âœ… GPU çŠ¶æ€è·Ÿè¸ª(available/allocated/error)

**API ç«¯ç‚¹**:
- âœ… POST `/api/v1/gpus` - æ³¨å†Œ GPU
- âœ… GET `/api/v1/gpus` - åˆ—å‡º GPU
- âœ… GET `/api/v1/gpus/:id` - è·å– GPU è¯¦æƒ…
- âœ… PUT `/api/v1/gpus/:id/status` - æ›´æ–° GPU çŠ¶æ€

### 4.3 ç¯å¢ƒç®¡ç†æ¨¡å— âœ…

**å®Œæˆåº¦**: 80%

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… Environment å®ä½“æ¨¡å‹ (`internal/model/entity/environment.go`)
- âœ… EnvironmentDao - CRUD æ“ä½œ
- âœ… EnvironmentService - ç¯å¢ƒç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… å¤šç§éƒ¨ç½²æ¨¡å¼æ”¯æŒ(K8s Pod/Docker/VM)
- âœ… GPU è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾
- âœ… ç«¯å£æ˜ å°„ç®¡ç†
- âœ… è®¿é—®ä¿¡æ¯ç”Ÿæˆ

#### æ”¯æŒçš„ç¯å¢ƒç±»å‹
- âœ… IDE ç¯å¢ƒ(SSH + Jupyter)
- âœ… Terminal ç¯å¢ƒ(SSH)
- âœ… Desktop ç¯å¢ƒ(SSH + RDP + VNC)
- âœ… Training ç¯å¢ƒ(SSH + TensorBoard)

**API ç«¯ç‚¹**:
- âœ… POST `/api/v1/environments` - åˆ›å»ºç¯å¢ƒ
- âœ… GET `/api/v1/environments` - åˆ—å‡ºç¯å¢ƒ
- âœ… GET `/api/v1/environments/:id` - è·å–ç¯å¢ƒè¯¦æƒ…
- âœ… DELETE `/api/v1/environments/:id` - åˆ é™¤ç¯å¢ƒ
- âœ… POST `/api/v1/environments/:id/start` - å¯åŠ¨ç¯å¢ƒ
- âœ… POST `/api/v1/environments/:id/stop` - åœæ­¢ç¯å¢ƒ
- âœ… GET `/api/v1/environments/:id/access` - è·å–è®¿é—®ä¿¡æ¯

### 4.4 èµ„æºé…é¢æ¨¡å— âœ…

**å®Œæˆåº¦**: 95%

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… ResourceQuota å®ä½“æ¨¡å‹
- âœ… ç”¨æˆ·çº§åˆ«é…é¢ç®¡ç†
- âœ… é…é¢æ£€æŸ¥(CPU/Memory/GPU/Storage)
- âœ… å·²ä½¿ç”¨èµ„æºç»Ÿè®¡
- âœ… å¯ç”¨é…é¢è®¡ç®—
- âœ… å¹¶å‘å®‰å…¨çš„é…é¢æ£€æŸ¥(æ‚²è§‚é”)

**API ç«¯ç‚¹**:
- âœ… POST `/api/v1/quotas` - è®¾ç½®é…é¢
- âœ… GET `/api/v1/quotas` - è·å–é…é¢
- âœ… PUT `/api/v1/quotas/:id` - æ›´æ–°é…é¢
- âœ… DELETE `/api/v1/quotas/:id` - åˆ é™¤é…é¢
- âœ… GET `/api/v1/quotas/usage` - è·å–èµ„æºä½¿ç”¨æƒ…å†µ

---

## 5. ä»0åˆ°1å®æ–½æ­¥éª¤

### 5.1 ç¯å¢ƒå‡†å¤‡

#### ç¬¬ä¸€æ­¥:å®‰è£…åŸºç¡€è½¯ä»¶

```bash
# 1. å®‰è£… Go 1.21+
wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin

# 2. å®‰è£… PostgreSQL 17
sudo apt-get install postgresql-17

# 3. å®‰è£… Redis
sudo apt-get install redis-server

# 4. å®‰è£… Docker (å¯é€‰)
curl -fsSL https://get.docker.com | sh

# 5. å®‰è£… Kubernetes (å¯é€‰)
# å‚è€ƒå®˜æ–¹æ–‡æ¡£å®‰è£… kubectl å’Œ minikube/k3s
```

#### ç¬¬äºŒæ­¥:é…ç½®æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql
CREATE DATABASE remotegpu;
CREATE USER remotegpu_user WITH PASSWORD 'remotegpu_password';
GRANT ALL PRIVILEGES ON DATABASE remotegpu TO remotegpu_user;
\q
```

### 5.2 é¡¹ç›®åˆå§‹åŒ–

#### ç¬¬ä¸€æ­¥:åˆ›å»ºé¡¹ç›®ç»“æ„

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p remotegpu/backend
cd remotegpu/backend

# åˆå§‹åŒ– Go æ¨¡å—
go mod init github.com/YoungBoyGod/remotegpu

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p cmd config internal/{controller/v1,dao,middleware,model/entity,router,service}
mkdir -p pkg/{auth,cache,database,deployment,errors,host,k8s,network,security,volume}
mkdir -p migrations sql docs k8s logs
```

#### ç¬¬äºŒæ­¥:åˆ›å»ºé…ç½®æ–‡ä»¶

åˆ›å»º `config/config.yaml`:

```yaml
server:
  port: 8080
  mode: debug

database:
  host: localhost
  port: 5432
  user: remotegpu_user
  password: remotegpu_password
  dbname: remotegpu

redis:
  host: localhost
  port: 6379
  password: ""
  db: 0
  pool_size: 10
  timeout: 5

jwt:
  secret: "your-secret-key-change-in-production"
  expire_time: 24

log:
  level: debug
  output_path: "./logs/app.log"
```

---

### 5.3 æ ¸å¿ƒæ¨¡å—å¼€å‘

#### ç¬¬ä¸€æ­¥:åŸºç¡€è®¾æ–½å±‚ (pkg/)

**1. æ•°æ®åº“è¿æ¥** (`pkg/database/database.go`)

```go
package database

import (
    "gorm.io/driver/postgres"
    "gorm.io/gorm"
)

var db *gorm.DB

func InitDB(dsn string) error {
    var err error
    db, err = gorm.Open(postgres.Open(dsn), &gorm.Config{})
    return err
}

func GetDB() *gorm.DB {
    return db
}
```

**2. ç¼“å­˜ç®¡ç†** (`pkg/cache/cache.go`)

```go
package cache

import (
    "context"
    "time"
    "github.com/redis/go-redis/v9"
)

type CacheManager struct {
    caches map[string]Cache
}

func NewCacheManager() *CacheManager {
    return &CacheManager{caches: make(map[string]Cache)}
}
```

**3. K8s å®¢æˆ·ç«¯** (`pkg/k8s/client.go`)

```go
package k8s

import (
    "k8s.io/client-go/kubernetes"
    "k8s.io/client-go/rest"
)

func GetClient() (*kubernetes.Clientset, error) {
    config, err := rest.InClusterConfig()
    if err != nil {
        return nil, err
    }
    return kubernetes.NewForConfig(config)
}
```

#### ç¬¬äºŒæ­¥:æ•°æ®æ¨¡å‹å±‚ (internal/model/entity/)

**åˆ›å»ºå®ä½“æ¨¡å‹**:

```go
// internal/model/entity/user.go
type User struct {
    ID        uint      `gorm:"primarykey"`
    Username  string    `gorm:"unique;not null"`
    Email     string    `gorm:"unique;not null"`
    Password  string    `gorm:"not null"`
    Role      string    `gorm:"default:'user'"`
    CreatedAt time.Time
    UpdatedAt time.Time
}

// internal/model/entity/host.go
type Host struct {
    ID          string `gorm:"primarykey"`
    Name        string
    IPAddress   string
    Status      string
    TotalCPU    int
    UsedCPU     int
    TotalMemory int64
    UsedMemory  int64
    TotalGPU    int
    UsedGPU     int
}

// internal/model/entity/environment.go
type Environment struct {
    ID              string `gorm:"primarykey"`
    UserID          uint
    HostID          string
    Name            string
    Image           string
    Status          string
    CPU             int
    Memory          int64
    GPU             int
    DeploymentMode  string
    EnvironmentType string
}
```

---

### 5.4 æ•°æ®åº“åˆå§‹åŒ–

#### ç¬¬ä¸€æ­¥:åˆ›å»ºæ•°æ®åº“è¡¨

åˆ›å»º `sql/03_users_and_permissions.sql`:

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE IF NOT EXISTS users (
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(64) UNIQUE NOT NULL,
    email VARCHAR(128) UNIQUE NOT NULL,
    password VARCHAR(256) NOT NULL,
    role VARCHAR(32) DEFAULT 'user',
    status VARCHAR(32) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- èµ„æºé…é¢è¡¨
CREATE TABLE IF NOT EXISTS resource_quotas (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    cpu INT DEFAULT 0,
    memory BIGINT DEFAULT 0,
    gpu INT DEFAULT 0,
    storage BIGINT DEFAULT 0,
    environment_quota INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

åˆ›å»º `sql/04_hosts_and_devices.sql`:

```sql
-- ä¸»æœºè¡¨
CREATE TABLE IF NOT EXISTS hosts (
    id VARCHAR(64) PRIMARY KEY,
    name VARCHAR(128) NOT NULL,
    ip_address VARCHAR(64) NOT NULL,
    status VARCHAR(32) DEFAULT 'active',
    total_cpu INT DEFAULT 0,
    used_cpu INT DEFAULT 0,
    total_memory BIGINT DEFAULT 0,
    used_memory BIGINT DEFAULT 0,
    total_gpu INT DEFAULT 0,
    used_gpu INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- GPUè¡¨
CREATE TABLE IF NOT EXISTS gpus (
    id BIGSERIAL PRIMARY KEY,
    host_id VARCHAR(64) NOT NULL,
    gpu_index INT NOT NULL,
    model VARCHAR(128),
    memory BIGINT,
    status VARCHAR(32) DEFAULT 'available',
    allocated_to VARCHAR(64),
    FOREIGN KEY (host_id) REFERENCES hosts(id)
);
```

#### ç¬¬äºŒæ­¥:æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–

```bash
# æ‰§è¡ŒSQLè„šæœ¬
psql -h localhost -U remotegpu_user -d remotegpu -f sql/03_users_and_permissions.sql
psql -h localhost -U remotegpu_user -d remotegpu -f sql/04_hosts_and_devices.sql
psql -h localhost -U remotegpu_user -d remotegpu -f sql/05_environments.sql
```

### 5.5 å¯åŠ¨å’Œæµ‹è¯•

#### ç¬¬ä¸€æ­¥:å®‰è£…ä¾èµ–

```bash
go mod tidy
```

#### ç¬¬äºŒæ­¥:å¯åŠ¨åº”ç”¨

```bash
go run cmd/main.go
```

#### ç¬¬ä¸‰æ­¥:æµ‹è¯•API

```bash
# 1. ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8080/api/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@example.com","password":"123456"}'

# 2. ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8080/api/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'

# 3. æ³¨å†Œä¸»æœº
curl -X POST http://localhost:8080/api/v1/hosts \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"id":"host-001","name":"GPU Server 1","ip_address":"192.168.1.100"}'
```

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 æ ¸å¿ƒè¡¨ç»“æ„

#### users (ç”¨æˆ·è¡¨)
- id: ä¸»é”®
- username: ç”¨æˆ·å(å”¯ä¸€)
- email: é‚®ç®±(å”¯ä¸€)
- password: å¯†ç (bcryptåŠ å¯†)
- role: è§’è‰²(user/admin)
- status: çŠ¶æ€(active/inactive)

#### hosts (ä¸»æœºè¡¨)
- id: ä¸»é”®
- name: ä¸»æœºåç§°
- ip_address: IPåœ°å€
- total_cpu/used_cpu: CPUèµ„æº
- total_memory/used_memory: å†…å­˜èµ„æº
- total_gpu/used_gpu: GPUèµ„æº

#### environments (ç¯å¢ƒè¡¨)
- id: UUIDä¸»é”®
- user_id: ç”¨æˆ·ID(å¤–é”®)
- host_id: ä¸»æœºID(å¤–é”®)
- name: ç¯å¢ƒåç§°
- image: é•œåƒåç§°
- status: çŠ¶æ€(creating/running/stopped)
- cpu/memory/gpu: èµ„æºé…ç½®

#### resource_quotas (èµ„æºé…é¢è¡¨)
- id: ä¸»é”®
- user_id: ç”¨æˆ·ID(å¤–é”®)
- cpu/memory/gpu/storage: èµ„æºé…é¢
- environment_quota: ç¯å¢ƒæ•°é‡é…é¢

### 6.2 è¡¨å…³ç³»
- users (1:N) environments
- users (1:1) resource_quotas
- hosts (1:N) environments
- hosts (1:N) gpus

---
