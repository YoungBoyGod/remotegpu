# A2 ResourceQuotaæ¨¡å— BugæŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: 2026-01-30
**æµ‹è¯•äººå‘˜**: ä¸“ä¸šæµ‹è¯•å›¢é˜Ÿ
**æ¨¡å—ç‰ˆæœ¬**: æäº¤ abca1cb
**æ•´ä½“è¯„ä»·**: â­â­â­â˜†â˜† (3/5)

---

## ğŸ”´ P0çº§åˆ« - ä¸¥é‡Bugï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰

### Bug #1: GetUsedResourcesé€»è¾‘é”™è¯¯ - ç”¨æˆ·çº§åˆ«é…é¢ç»Ÿè®¡ä¸æ­£ç¡®

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ Critical
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:197-198`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
if workspaceID != nil {
    query = query.Where("workspace_id = ?", *workspaceID)
} else {
    // é”™è¯¯ï¼šåº”è¯¥æŸ¥è¯¢è¯¥ç”¨æˆ·æ‰€æœ‰ç¯å¢ƒï¼Œè€Œä¸æ˜¯åªæŸ¥è¯¢workspace_id IS NULLçš„ç¯å¢ƒ
    query = query.Where("workspace_id IS NULL")
}
```

å½“æŸ¥è¯¢ç”¨æˆ·çº§åˆ«é…é¢ï¼ˆworkspaceIDä¸ºnilï¼‰çš„å·²ä½¿ç”¨èµ„æºæ—¶ï¼Œä»£ç åªç»Ÿè®¡äº†`workspace_id IS NULL`çš„ç¯å¢ƒï¼Œå®Œå…¨å¿½ç•¥äº†è¯¥ç”¨æˆ·åœ¨å„ä¸ªå·¥ä½œç©ºé—´ä¸­åˆ›å»ºçš„ç¯å¢ƒã€‚

**å½±å“**:
- ç”¨æˆ·çº§åˆ«é…é¢æ£€æŸ¥ä¸å‡†ç¡®
- ç”¨æˆ·å¯ä»¥åœ¨å·¥ä½œç©ºé—´ä¸­æ— é™åˆ›å»ºç¯å¢ƒï¼Œç»•è¿‡ç”¨æˆ·çº§åˆ«é…é¢é™åˆ¶
- å¯èƒ½å¯¼è‡´èµ„æºä¸¥é‡è¶…é¢åˆ†é…

**å¤ç°æ­¥éª¤**:
1. ä¸ºç”¨æˆ·è®¾ç½®ç”¨æˆ·çº§åˆ«é…é¢ï¼šCPU=10
2. ç”¨æˆ·åœ¨å·¥ä½œç©ºé—´Aä¸­åˆ›å»ºç¯å¢ƒï¼Œä½¿ç”¨8ä¸ªCPU
3. è°ƒç”¨CheckQuotaæ£€æŸ¥ç”¨æˆ·çº§åˆ«é…é¢
4. ç»“æœï¼šæ˜¾ç¤ºå·²ä½¿ç”¨0ä¸ªCPUï¼Œå¯ç”¨10ä¸ªCPUï¼ˆé”™è¯¯ï¼ï¼‰

**é¢„æœŸè¡Œä¸º**:
ç”¨æˆ·çº§åˆ«é…é¢åº”è¯¥ç»Ÿè®¡è¯¥ç”¨æˆ·åœ¨æ‰€æœ‰å·¥ä½œç©ºé—´ä¸­çš„èµ„æºä½¿ç”¨æ€»å’Œã€‚

**å»ºè®®ä¿®å¤**:
```go
if workspaceID != nil {
    // æŸ¥è¯¢ç‰¹å®šå·¥ä½œç©ºé—´çš„ç¯å¢ƒ
    query = query.Where("workspace_id = ?", *workspaceID)
} else {
    // æŸ¥è¯¢è¯¥ç”¨æˆ·æ‰€æœ‰ç¯å¢ƒï¼ˆä¸é™åˆ¶workspace_idï¼‰
    // ä¸éœ€è¦é¢å¤–çš„WHEREæ¡ä»¶ï¼Œå› ä¸ºå·²ç»æœ‰customer_idè¿‡æ»¤
}
```

---

### Bug #2: å¹¶å‘ç«æ€æ¡ä»¶ - TOCTOUé—®é¢˜å¯¼è‡´é…é¢è¶…é¢åˆ†é…

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ Critical
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:130-183`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
CheckQuotaæ–¹æ³•å­˜åœ¨å…¸å‹çš„"æ£€æŸ¥æ—¶é—´åˆ°ä½¿ç”¨æ—¶é—´"ï¼ˆTime-of-Check-Time-of-Useï¼‰ç«æ€æ¡ä»¶ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤šä¸ªè¯·æ±‚å¯èƒ½åŒæ—¶é€šè¿‡é…é¢æ£€æŸ¥ï¼Œå¯¼è‡´èµ„æºè¶…é¢åˆ†é…ã€‚

**å½±å“**:
- åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œé…é¢é™åˆ¶å¤±æ•ˆ
- å¯èƒ½å¯¼è‡´èµ„æºä¸¥é‡è¶…é¢åˆ†é…
- ç³»ç»Ÿèµ„æºè€—å°½

**å¤ç°æ­¥éª¤**:
1. è®¾ç½®ç”¨æˆ·é…é¢ï¼šCPU=10
2. å¹¶å‘å‘é€10ä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éœ€è¦2ä¸ªCPU
3. æ‰€æœ‰è¯·æ±‚åŒæ—¶æ£€æŸ¥é…é¢ï¼Œéƒ½æ˜¾ç¤ºå¯ç”¨10ä¸ªCPU
4. æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡æ£€æŸ¥ï¼Œåˆ›å»ºç¯å¢ƒ
5. ç»“æœï¼šå®é™…ä½¿ç”¨20ä¸ªCPUï¼Œè¶…è¿‡é…é¢

**æ—¶åºå›¾**:
```
æ—¶é—´ | çº¿ç¨‹A              | çº¿ç¨‹B
-----|-------------------|-------------------
T1   | CheckQuota(8 CPU) |
T2   | æŸ¥è¯¢ï¼šå¯ç”¨10 CPU   |
T3   |                   | CheckQuota(8 CPU)
T4   |                   | æŸ¥è¯¢ï¼šå¯ç”¨10 CPU
T5   | è¿”å›ï¼šé€šè¿‡         |
T6   |                   | è¿”å›ï¼šé€šè¿‡
T7   | åˆ›å»ºç¯å¢ƒ(8 CPU)    |
T8   |                   | åˆ›å»ºç¯å¢ƒ(8 CPU)
ç»“æœ | å®é™…ä½¿ç”¨16 CPUï¼Œè¶…è¿‡é…é¢10 CPU
```

**å»ºè®®ä¿®å¤æ–¹æ¡ˆ1 - æ•°æ®åº“æ‚²è§‚é”**:
```go
func (s *ResourceQuotaService) CheckQuota(customerID uint, workspaceID *uint, request *ResourceRequest) (bool, error) {
    // å¼€å¯äº‹åŠ¡
    tx := database.GetDB().Begin()
    defer func() {
        if r := recover(); r != nil {
            tx.Rollback()
        }
    }()

    // ä½¿ç”¨FOR UPDATEé”å®šé…é¢è®°å½•
    var quota entity.ResourceQuota
    err := tx.Clauses(clause.Locking{Strength: "UPDATE"}).
        Where("customer_id = ? AND workspace_id = ?", customerID, workspaceID).
        First(&quota).Error
    if err != nil {
        tx.Rollback()
        return false, err
    }

    // æŸ¥è¯¢å·²ä½¿ç”¨èµ„æºï¼ˆåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼‰
    used, err := s.GetUsedResourcesInTx(tx, customerID, workspaceID)
    // ... åç»­æ£€æŸ¥é€»è¾‘

    tx.Commit()
    return true, nil
}
```

**å»ºè®®ä¿®å¤æ–¹æ¡ˆ2 - åˆ†å¸ƒå¼é”**:
```go
func (s *ResourceQuotaService) CheckQuota(customerID uint, workspaceID *uint, request *ResourceRequest) (bool, error) {
    // ä½¿ç”¨Redisåˆ†å¸ƒå¼é”
    lockKey := fmt.Sprintf("quota:lock:%d:%v", customerID, workspaceID)
    lock := redis.NewLock(lockKey, 5*time.Second)

    if !lock.Acquire() {
        return false, fmt.Errorf("è·å–é…é¢é”å¤±è´¥")
    }
    defer lock.Release()

    // åœ¨é”ä¿æŠ¤ä¸‹æ‰§è¡Œé…é¢æ£€æŸ¥
    // ... æ£€æŸ¥é€»è¾‘
}
```

---

### Bug #3: ç¼ºå°‘å”¯ä¸€æ€§çº¦æŸ - å¯èƒ½åˆ›å»ºé‡å¤é…é¢è®°å½•

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ Critical
**æ–‡ä»¶ä½ç½®**: `internal/model/entity/resource_quota.go:10-11`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
CustomerID  uint  `gorm:"not null;index:idx_resource_quotas_customer" json:"customer_id"`
WorkspaceID *uint `gorm:"index:idx_resource_quotas_workspace" json:"workspace_id"`
```

æ•°æ®åº“å±‚é¢æ²¡æœ‰å”¯ä¸€ç´¢å¼•ä¿è¯ä¸€ä¸ª`(customer_id, workspace_id)`ç»„åˆåªæœ‰ä¸€ä¸ªé…é¢è®°å½•ã€‚è™½ç„¶SetQuotaæ–¹æ³•åœ¨åº”ç”¨å±‚åšäº†æ£€æŸ¥ï¼Œä½†åœ¨å¹¶å‘æƒ…å†µä¸‹ä»å¯èƒ½åˆ›å»ºé‡å¤è®°å½•ã€‚

**å½±å“**:
- å¯èƒ½åˆ›å»ºé‡å¤çš„é…é¢è®°å½•
- å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- GetQuotaå¯èƒ½è¿”å›é”™è¯¯çš„é…é¢ï¼ˆFirståªè¿”å›ç¬¬ä¸€æ¡ï¼‰
- é…é¢ç®¡ç†æ··ä¹±

**å¤ç°æ­¥éª¤**:
1. å¹¶å‘è°ƒç”¨SetQuotaï¼Œä¸ºåŒä¸€ä¸ªcustomer+workspaceè®¾ç½®é…é¢
2. ä¸¤ä¸ªè¯·æ±‚åŒæ—¶æŸ¥è¯¢ï¼Œéƒ½æ²¡æ‰¾åˆ°ç°æœ‰é…é¢
3. ä¸¤ä¸ªè¯·æ±‚éƒ½æ‰§è¡ŒCreateæ“ä½œ
4. ç»“æœï¼šæ•°æ®åº“ä¸­å­˜åœ¨ä¸¤æ¡ç›¸åŒçš„é…é¢è®°å½•

**å»ºè®®ä¿®å¤**:
```go
type ResourceQuota struct {
    ID          uint      `gorm:"primarykey" json:"id"`
    CustomerID  uint      `gorm:"not null;uniqueIndex:idx_customer_workspace" json:"customer_id"`
    WorkspaceID *uint     `gorm:"uniqueIndex:idx_customer_workspace" json:"workspace_id"`
    // ... å…¶ä»–å­—æ®µ
}
```

**æ³¨æ„**: ç”±äºWorkspaceIDæ˜¯æŒ‡é’ˆç±»å‹ï¼ˆå¯ä¸ºNULLï¼‰ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†NULLå€¼çš„å”¯ä¸€æ€§ã€‚å¯èƒ½éœ€è¦ä½¿ç”¨æ•°æ®åº“çš„éƒ¨åˆ†å”¯ä¸€ç´¢å¼•æˆ–è§¦å‘å™¨ã€‚

---

## ğŸŸ¡ P1çº§åˆ« - é«˜ä¼˜å…ˆçº§Bugï¼ˆåº”å°½å¿«ä¿®å¤ï¼‰

### Bug #4: ç¼ºå°‘å¤–é”®éªŒè¯ - å¯èƒ½ä¸ºæ— æ•ˆå®ä½“è®¾ç½®é…é¢

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ High
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:53-80`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
SetQuotaæ–¹æ³•æ²¡æœ‰éªŒè¯ï¼š
- CustomerIDæ˜¯å¦å­˜åœ¨
- WorkspaceIDæ˜¯å¦å­˜åœ¨ï¼ˆå¦‚æœä¸ä¸ºç©ºï¼‰
- WorkspaceIDæ˜¯å¦å±äºè¯¥CustomerID

**å½±å“**:
- å¯èƒ½ä¸ºä¸å­˜åœ¨çš„å®¢æˆ·è®¾ç½®é…é¢
- å¯èƒ½ä¸ºä¸å­˜åœ¨çš„å·¥ä½œç©ºé—´è®¾ç½®é…é¢
- å¯èƒ½ä¸ºå®¢æˆ·è®¾ç½®ä¸å±äºä»–çš„å·¥ä½œç©ºé—´é…é¢
- æ•°æ®å®Œæ•´æ€§é—®é¢˜

**å¤ç°æ­¥éª¤**:
1. è°ƒç”¨SetQuotaï¼ŒcustomerID=99999ï¼ˆä¸å­˜åœ¨ï¼‰
2. æˆåŠŸåˆ›å»ºé…é¢è®°å½•
3. ç»“æœï¼šé…é¢è®°å½•æŒ‡å‘ä¸å­˜åœ¨çš„å®¢æˆ·

**å»ºè®®ä¿®å¤**:
```go
func (s *ResourceQuotaService) SetQuota(quota *entity.ResourceQuota) error {
    // éªŒè¯é…é¢å€¼
    if quota.CPU < 0 || quota.Memory < 0 || quota.GPU < 0 || quota.Storage < 0 {
        return fmt.Errorf("é…é¢å€¼ä¸èƒ½ä¸ºè´Ÿæ•°")
    }

    // éªŒè¯CustomerIDæ˜¯å¦å­˜åœ¨
    customerDao := dao.NewCustomerDao()
    _, err := customerDao.GetByID(quota.CustomerID)
    if err != nil {
        return fmt.Errorf("å®¢æˆ·ä¸å­˜åœ¨: %w", err)
    }

    // éªŒè¯WorkspaceIDï¼ˆå¦‚æœä¸ä¸ºç©ºï¼‰
    if quota.WorkspaceID != nil {
        workspaceDao := dao.NewWorkspaceDao()
        workspace, err := workspaceDao.GetByID(*quota.WorkspaceID)
        if err != nil {
            return fmt.Errorf("å·¥ä½œç©ºé—´ä¸å­˜åœ¨: %w", err)
        }
        // éªŒè¯å·¥ä½œç©ºé—´å±äºè¯¥å®¢æˆ·
        if workspace.OwnerID != quota.CustomerID {
            return fmt.Errorf("å·¥ä½œç©ºé—´ä¸å±äºè¯¥å®¢æˆ·")
        }
    }

    // ... åç»­é€»è¾‘
}
```

---

### Bug #5: è´Ÿæ•°å¯ç”¨é…é¢æœªå¤„ç† - å¯èƒ½è¿”å›å¼‚å¸¸æ•°æ®

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ High
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:240-247`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
available := &entity.ResourceQuota{
    CustomerID:  customerID,
    WorkspaceID: workspaceID,
    CPU:         quota.CPU - used.CPU,      // å¯èƒ½ä¸ºè´Ÿæ•°
    Memory:      quota.Memory - used.Memory, // å¯èƒ½ä¸ºè´Ÿæ•°
    GPU:         quota.GPU - used.GPU,      // å¯èƒ½ä¸ºè´Ÿæ•°
    Storage:     quota.Storage - used.Storage, // å¯èƒ½ä¸ºè´Ÿæ•°
}
```

å½“å·²ä½¿ç”¨èµ„æºè¶…è¿‡æ€»é…é¢æ—¶ï¼ˆå¯èƒ½ç”±äºå¹¶å‘é—®é¢˜ã€æ‰‹åŠ¨ä¿®æ”¹æ•°æ®æˆ–Bug #2ï¼‰ï¼ŒGetAvailableQuotaä¼šè¿”å›è´Ÿæ•°ã€‚

**å½±å“**:
- è°ƒç”¨æ–¹å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†è´Ÿæ•°é…é¢
- å¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯æˆ–å´©æºƒ
- ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸

**å¤ç°æ­¥éª¤**:
1. è®¾ç½®é…é¢ï¼šCPU=10
2. ç”±äºå¹¶å‘é—®é¢˜ï¼Œå®é™…åˆ›å»ºäº†ä½¿ç”¨15ä¸ªCPUçš„ç¯å¢ƒ
3. è°ƒç”¨GetAvailableQuota
4. ç»“æœï¼šè¿”å›CPU=-5

**å»ºè®®ä¿®å¤**:
```go
available := &entity.ResourceQuota{
    CustomerID:  customerID,
    WorkspaceID: workspaceID,
    CPU:         max(0, quota.CPU - used.CPU),
    Memory:      max(0, quota.Memory - used.Memory),
    GPU:         max(0, quota.GPU - used.GPU),
    Storage:     max(0, quota.Storage - used.Storage),
}

// æˆ–è€…è¿”å›é”™è¯¯
if quota.CPU < used.CPU {
    return nil, fmt.Errorf("é…é¢å·²è¶…é™: CPUå·²ä½¿ç”¨%dï¼Œè¶…è¿‡é…é¢%d", used.CPU, quota.CPU)
}
```

---

### Bug #6: UpdateQuotaæœªéªŒè¯é…é¢æ˜¯å¦å°äºå·²ä½¿ç”¨èµ„æº

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ High
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:106-112`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
// æ›´æ–°å­—æ®µ
existing.CPU = quota.CPU  // æ²¡æœ‰æ£€æŸ¥æ˜¯å¦å°äºå·²ä½¿ç”¨çš„CPU
existing.Memory = quota.Memory
existing.GPU = quota.GPU
existing.Storage = quota.Storage
```

UpdateQuotaæ–¹æ³•å…è®¸å°†é…é¢æ›´æ–°ä¸ºå°äºå·²ä½¿ç”¨èµ„æºçš„å€¼ï¼Œå¯¼è‡´ç³»ç»Ÿè¿›å…¥ä¸ä¸€è‡´çŠ¶æ€ã€‚

**å½±å“**:
- å¯ç”¨é…é¢å˜ä¸ºè´Ÿæ•°
- ç³»ç»Ÿè¿›å…¥ä¸ä¸€è‡´çŠ¶æ€
- åç»­é…é¢æ£€æŸ¥å¤±è´¥

**å¤ç°æ­¥éª¤**:
1. è®¾ç½®é…é¢ï¼šCPU=20
2. åˆ›å»ºç¯å¢ƒï¼Œä½¿ç”¨15ä¸ªCPU
3. è°ƒç”¨UpdateQuotaï¼Œå°†é…é¢æ”¹ä¸º10ä¸ªCPU
4. æˆåŠŸæ›´æ–°
5. è°ƒç”¨GetAvailableQuota
6. ç»“æœï¼šå¯ç”¨CPU=-5

**å»ºè®®ä¿®å¤**:
```go
func (s *ResourceQuotaService) UpdateQuota(quota *entity.ResourceQuota) error {
    // ... å‰é¢çš„éªŒè¯

    // è·å–å·²ä½¿ç”¨èµ„æº
    used, err := s.GetUsedResources(existing.CustomerID, existing.WorkspaceID)
    if err != nil {
        return fmt.Errorf("è·å–å·²ä½¿ç”¨èµ„æºå¤±è´¥: %w", err)
    }

    // éªŒè¯æ–°é…é¢æ˜¯å¦å°äºå·²ä½¿ç”¨èµ„æº
    if quota.CPU < used.CPU {
        return fmt.Errorf("CPUé…é¢ä¸èƒ½å°äºå·²ä½¿ç”¨é‡: å·²ä½¿ç”¨%dï¼Œæ–°é…é¢%d", used.CPU, quota.CPU)
    }
    if quota.Memory < used.Memory {
        return fmt.Errorf("å†…å­˜é…é¢ä¸èƒ½å°äºå·²ä½¿ç”¨é‡: å·²ä½¿ç”¨%dï¼Œæ–°é…é¢%d", used.Memory, quota.Memory)
    }
    // ... å…¶ä»–èµ„æºæ£€æŸ¥

    // æ›´æ–°å­—æ®µ
    existing.CPU = quota.CPU
    existing.Memory = quota.Memory
    existing.GPU = quota.GPU
    existing.Storage = quota.Storage

    return s.quotaDao.Update(existing)
}
```

---

### Bug #7: DeleteQuotaæœªæ£€æŸ¥ä¾èµ– - å¯èƒ½åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„é…é¢

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ High
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:116-127`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
func (s *ResourceQuotaService) DeleteQuota(id uint) error {
    // æ£€æŸ¥é…é¢æ˜¯å¦å­˜åœ¨
    _, err := s.quotaDao.GetByID(id)
    if err != nil {
        if errors.Is(err, gorm.ErrRecordNotFound) {
            return fmt.Errorf("é…é¢ä¸å­˜åœ¨")
        }
        return err
    }

    return s.quotaDao.Delete(id)  // ç›´æ¥åˆ é™¤ï¼Œæ²¡æœ‰æ£€æŸ¥ä¾èµ–
}
```

åˆ é™¤é…é¢å‰æ²¡æœ‰æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„ç¯å¢ƒä½¿ç”¨è¯¥é…é¢ã€‚

**å½±å“**:
- åˆ é™¤é…é¢åï¼Œç°æœ‰ç¯å¢ƒå¤±å»é…é¢çº¦æŸ
- å¯èƒ½å¯¼è‡´èµ„æºç®¡ç†æ··ä¹±
- æ— æ³•è¿½æº¯ç¯å¢ƒçš„é…é¢å†å²

**å»ºè®®ä¿®å¤**:
```go
func (s *ResourceQuotaService) DeleteQuota(id uint) error {
    // æ£€æŸ¥é…é¢æ˜¯å¦å­˜åœ¨
    quota, err := s.quotaDao.GetByID(id)
    if err != nil {
        if errors.Is(err, gorm.ErrRecordNotFound) {
            return fmt.Errorf("é…é¢ä¸å­˜åœ¨")
        }
        return err
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„ç¯å¢ƒ
    used, err := s.GetUsedResources(quota.CustomerID, quota.WorkspaceID)
    if err != nil {
        return fmt.Errorf("æ£€æŸ¥èµ„æºä½¿ç”¨å¤±è´¥: %w", err)
    }

    if used.CPU > 0 || used.Memory > 0 || used.GPU > 0 || used.Storage > 0 {
        return fmt.Errorf("æ— æ³•åˆ é™¤é…é¢: ä»æœ‰%dä¸ªCPUã€%dMBå†…å­˜ã€%dä¸ªGPUã€%dGBå­˜å‚¨æ­£åœ¨ä½¿ç”¨",
            used.CPU, used.Memory, used.GPU, used.Storage)
    }

    return s.quotaDao.Delete(id)
}
```

---

## ğŸŸ¢ P2çº§åˆ« - ä¸­ç­‰ä¼˜å…ˆçº§Bugï¼ˆå»ºè®®ä¿®å¤ï¼‰

### Bug #8: GetUsedResourcesæœªè€ƒè™‘creatingçŠ¶æ€ - èµ„æºç»Ÿè®¡ä¸å®Œæ•´

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:191`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
query := db.Where("customer_id = ? AND status = ?", customerID, "running")
```

åªç»Ÿè®¡`status='running'`çš„ç¯å¢ƒï¼Œå¿½ç•¥äº†`status='creating'`çš„ç¯å¢ƒã€‚

**å½±å“**:
- åœ¨ç¯å¢ƒåˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œèµ„æºå·²ç»è¢«åˆ†é…ï¼Œä½†æœªè¢«ç»Ÿè®¡
- å¯èƒ½å¯¼è‡´è¶…é¢åˆ†é…
- é…é¢æ£€æŸ¥ä¸å‡†ç¡®

**åœºæ™¯**:
1. é…é¢ï¼šCPU=10
2. ç¯å¢ƒAæ­£åœ¨åˆ›å»ºä¸­ï¼ˆcreatingï¼‰ï¼Œä½¿ç”¨8ä¸ªCPU
3. ç”¨æˆ·è¯·æ±‚åˆ›å»ºç¯å¢ƒBï¼Œéœ€è¦8ä¸ªCPU
4. CheckQuotaæŸ¥è¯¢å·²ä½¿ç”¨èµ„æºï¼š0ä¸ªCPUï¼ˆå› ä¸ºç¯å¢ƒAæ˜¯creatingçŠ¶æ€ï¼‰
5. æ£€æŸ¥é€šè¿‡ï¼Œåˆ›å»ºç¯å¢ƒB
6. ç»“æœï¼šå®é™…ä½¿ç”¨16ä¸ªCPUï¼Œè¶…è¿‡é…é¢

**å»ºè®®ä¿®å¤**:
```go
query := db.Where("customer_id = ? AND status IN ?", customerID, []string{"running", "creating"})
```

---

### Bug #9: GetUsedResourcesæ€§èƒ½é—®é¢˜ - ç¼ºå°‘ç¼“å­˜æœºåˆ¶

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:186-223`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
æ¯æ¬¡è°ƒç”¨GetUsedResourceséƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œæ²¡æœ‰ä»»ä½•ç¼“å­˜æœºåˆ¶ã€‚

**å½±å“**:
- åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“å‹åŠ›å¤§
- å“åº”æ—¶é—´è¾ƒé•¿
- å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ

**æ€§èƒ½æµ‹è¯•æ•°æ®**ï¼ˆå‡è®¾ï¼‰:
- å•æ¬¡æŸ¥è¯¢è€—æ—¶ï¼š50ms
- å¹¶å‘100ä¸ªè¯·æ±‚ï¼šæ•°æ®åº“è¿æ¥æ± å¯èƒ½è€—å°½
- QPSä¸Šé™ï¼šçº¦200ï¼ˆå—æ•°æ®åº“é™åˆ¶ï¼‰

**å»ºè®®ä¿®å¤**:
```go
// ä½¿ç”¨Redisç¼“å­˜ï¼ŒTTL=30ç§’
func (s *ResourceQuotaService) GetUsedResources(customerID uint, workspaceID *uint) (*UsedResources, error) {
    cacheKey := fmt.Sprintf("quota:used:%d:%v", customerID, workspaceID)

    // å°è¯•ä»ç¼“å­˜è·å–
    cached, err := redis.Get(cacheKey)
    if err == nil {
        var used UsedResources
        json.Unmarshal(cached, &used)
        return &used, nil
    }

    // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
    db := database.GetDB()
    // ... æŸ¥è¯¢é€»è¾‘

    // å†™å…¥ç¼“å­˜
    data, _ := json.Marshal(used)
    redis.Set(cacheKey, data, 30*time.Second)

    return used, nil
}
```

**æ³¨æ„**: ä½¿ç”¨ç¼“å­˜åéœ€è¦åœ¨ç¯å¢ƒåˆ›å»º/åˆ é™¤æ—¶ä¸»åŠ¨å¤±æ•ˆç¼“å­˜ã€‚

---

### Bug #10: Listæ–¹æ³•ç¼ºå°‘å‚æ•°éªŒè¯ - å¯èƒ½å¯¼è‡´å¼‚å¸¸

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: `internal/dao/resource_quota.go:77-92`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
func (d *ResourceQuotaDao) List(page, pageSize int) ([]*entity.ResourceQuota, int64, error) {
    var quotas []*entity.ResourceQuota
    var total int64

    offset := (page - 1) * pageSize  // page=0æ—¶ï¼Œoffsetä¸ºè´Ÿæ•°
    // ...
}
```

æ²¡æœ‰éªŒè¯pageå’ŒpageSizeçš„æœ‰æ•ˆæ€§ã€‚

**å½±å“**:
- page=0æˆ–è´Ÿæ•°æ—¶ï¼Œoffsetä¸ºè´Ÿæ•°ï¼Œå¯èƒ½å¯¼è‡´SQLé”™è¯¯
- pageSizeè¿‡å¤§æ—¶ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º
- pageSizeä¸º0æˆ–è´Ÿæ•°æ—¶ï¼ŒæŸ¥è¯¢ç»“æœå¼‚å¸¸

**å¤ç°æ­¥éª¤**:
1. è°ƒç”¨List(0, 10)
2. offset = (0-1) * 10 = -10
3. SQL: OFFSET -10ï¼ˆå¯èƒ½æŠ¥é”™æˆ–è¿”å›å¼‚å¸¸ç»“æœï¼‰

**å»ºè®®ä¿®å¤**:
```go
func (d *ResourceQuotaDao) List(page, pageSize int) ([]*entity.ResourceQuota, int64, error) {
    // å‚æ•°éªŒè¯
    if page < 1 {
        page = 1
    }
    if pageSize < 1 {
        pageSize = 10
    }
    if pageSize > 100 {
        pageSize = 100  // é™åˆ¶æœ€å¤§é¡µé¢å¤§å°
    }

    var quotas []*entity.ResourceQuota
    var total int64

    offset := (page - 1) * pageSize
    // ...
}
```

---

### Bug #11: SetQuotaä¿®æ”¹ä¼ å…¥å‚æ•° - è¿åå‡½æ•°è®¾è®¡åŸåˆ™

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: `internal/service/resource_quota.go:74-76`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
```go
if existing != nil {
    quota.ID = existing.ID  // ä¿®æ”¹äº†è°ƒç”¨è€…ä¼ å…¥çš„å¯¹è±¡
    return s.quotaDao.Update(quota)
}
```

ç›´æ¥ä¿®æ”¹ä¼ å…¥çš„quotaå¯¹è±¡çš„IDå­—æ®µï¼Œè¿åäº†å‡½æ•°ä¸åº”ä¿®æ”¹å‚æ•°çš„åŸåˆ™ã€‚

**å½±å“**:
- è°ƒç”¨è€…å¯èƒ½ä¸æœŸæœ›ä¼ å…¥çš„å¯¹è±¡è¢«ä¿®æ”¹
- å¯èƒ½å¯¼è‡´æ„å¤–è¡Œä¸º
- ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§é™ä½

**ç¤ºä¾‹**:
```go
quota := &entity.ResourceQuota{
    CustomerID: 1,
    CPU: 10,
}
service.SetQuota(quota)
fmt.Println(quota.ID)  // æ„å¤–åœ°è¢«ä¿®æ”¹äº†ï¼
```

**å»ºè®®ä¿®å¤**:
```go
if existing != nil {
    // åˆ›å»ºæ–°å¯¹è±¡ï¼Œä¸ä¿®æ”¹ä¼ å…¥å‚æ•°
    updated := &entity.ResourceQuota{
        ID:          existing.ID,
        CustomerID:  quota.CustomerID,
        WorkspaceID: quota.WorkspaceID,
        CPU:         quota.CPU,
        Memory:      quota.Memory,
        GPU:         quota.GPU,
        Storage:     quota.Storage,
    }
    return s.quotaDao.Update(updated)
}
```

---

### Bug #12: ç¼ºå°‘è½¯åˆ é™¤æ”¯æŒ - æ— æ³•è¿½æº¯å†å²

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: `internal/model/entity/resource_quota.go`
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
ResourceQuotaå®ä½“æ²¡æœ‰DeletedAtå­—æ®µï¼Œåˆ é™¤æ“ä½œæ˜¯ç¡¬åˆ é™¤ã€‚

**å½±å“**:
- æ— æ³•è¿½æº¯å†å²é…é¢è®°å½•
- ä¸åˆ©äºå®¡è®¡å’Œé—®é¢˜æ’æŸ¥
- æ— æ³•æ¢å¤è¯¯åˆ é™¤çš„é…é¢

**å»ºè®®ä¿®å¤**:
```go
type ResourceQuota struct {
    ID          uint           `gorm:"primarykey" json:"id"`
    CustomerID  uint           `gorm:"not null;index:idx_resource_quotas_customer" json:"customer_id"`
    WorkspaceID *uint          `gorm:"index:idx_resource_quotas_workspace" json:"workspace_id"`
    CPU         int            `gorm:"not null;default:0" json:"cpu"`
    Memory      int64          `gorm:"not null;default:0" json:"memory"`
    GPU         int            `gorm:"not null;default:0" json:"gpu"`
    Storage     int64          `gorm:"not null;default:0" json:"storage"`
    CreatedAt   time.Time      `json:"created_at"`
    UpdatedAt   time.Time      `json:"updated_at"`
    DeletedAt   gorm.DeletedAt `gorm:"index" json:"-"`  // æ·»åŠ è½¯åˆ é™¤æ”¯æŒ

    // å…³è”å…³ç³»
    Customer  *Customer  `gorm:"foreignKey:CustomerID" json:"customer,omitempty"`
    Workspace *Workspace `gorm:"foreignKey:WorkspaceID" json:"workspace,omitempty"`
}
```

---

### Bug #13: é”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»† - éš¾ä»¥æ’æŸ¥é—®é¢˜

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: å¤šå¤„
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
é”™è¯¯ä¿¡æ¯ç¼ºå°‘ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¦‚customerIDã€workspaceIDç­‰ã€‚

**ç¤ºä¾‹**:
```go
return fmt.Errorf("é…é¢å€¼ä¸èƒ½ä¸ºè´Ÿæ•°")
return fmt.Errorf("é…é¢ä¸å­˜åœ¨")
return fmt.Errorf("æœªè®¾ç½®èµ„æºé…é¢")
```

**å½±å“**:
- æ’æŸ¥é—®é¢˜æ—¶éš¾ä»¥å®šä½å…·ä½“æ˜¯å“ªä¸ªé…é¢å‡ºé”™
- æ—¥å¿—ä¿¡æ¯ä¸å®Œæ•´
- å¢åŠ è¿ç»´æˆæœ¬

**å»ºè®®ä¿®å¤**:
```go
return fmt.Errorf("é…é¢å€¼ä¸èƒ½ä¸ºè´Ÿæ•°: customerID=%d, workspaceID=%v, CPU=%d, Memory=%d, GPU=%d, Storage=%d",
    quota.CustomerID, quota.WorkspaceID, quota.CPU, quota.Memory, quota.GPU, quota.Storage)

return fmt.Errorf("é…é¢ä¸å­˜åœ¨: id=%d", id)

return fmt.Errorf("æœªè®¾ç½®èµ„æºé…é¢: customerID=%d, workspaceID=%v", customerID, workspaceID)
```

---

### Bug #14: ç¼ºå°‘æ—¥å¿—è®°å½• - æ— æ³•è¿½è¸ªæ“ä½œå†å²

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¢ Medium
**æ–‡ä»¶ä½ç½®**: æ•´ä¸ªæ¨¡å—
**å‘ç°æ—¶é—´**: 2026-01-30

**é—®é¢˜æè¿°**:
æ•´ä¸ªResourceQuotaæ¨¡å—æ²¡æœ‰ä»»ä½•æ—¥å¿—è®°å½•ã€‚

**å½±å“**:
- æ— æ³•è¿½è¸ªé…é¢å˜æ›´å†å²
- éš¾ä»¥æ’æŸ¥ç”Ÿäº§é—®é¢˜
- æ— æ³•ç›‘æ§é…é¢ä½¿ç”¨æƒ…å†µ
- ç¼ºå°‘å®¡è®¡è®°å½•

**å»ºè®®æ·»åŠ çš„æ—¥å¿—**:
```go
func (s *ResourceQuotaService) SetQuota(quota *entity.ResourceQuota) error {
    log.Info("è®¾ç½®èµ„æºé…é¢",
        "customerID", quota.CustomerID,
        "workspaceID", quota.WorkspaceID,
        "cpu", quota.CPU,
        "memory", quota.Memory,
        "gpu", quota.GPU,
        "storage", quota.Storage)

    // ... ä¸šåŠ¡é€»è¾‘

    log.Info("èµ„æºé…é¢è®¾ç½®æˆåŠŸ", "quotaID", quota.ID)
    return nil
}

func (s *ResourceQuotaService) CheckQuota(customerID uint, workspaceID *uint, request *ResourceRequest) (bool, error) {
    log.Debug("æ£€æŸ¥èµ„æºé…é¢",
        "customerID", customerID,
        "workspaceID", workspaceID,
        "request", request)

    // ... æ£€æŸ¥é€»è¾‘

    if !ok {
        log.Warn("é…é¢æ£€æŸ¥å¤±è´¥",
            "customerID", customerID,
            "workspaceID", workspaceID,
            "request", request,
            "error", err)
    }

    return ok, err
}
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡é—®é¢˜

### ç¼ºå¤±çš„æµ‹è¯•ç”¨ä¾‹

**è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆæœªè¦†ç›–ï¼‰**:
- âŒ é…é¢ä¸º0çš„æƒ…å†µ
- âŒ è¯·æ±‚èµ„æºä¸º0çš„æƒ…å†µ
- âŒ è¯·æ±‚èµ„æºä¸ºè´Ÿæ•°çš„æƒ…å†µ
- âŒ å·²ä½¿ç”¨èµ„æºè¶…è¿‡æ€»é…é¢çš„æƒ…å†µ
- âŒ page=0æˆ–è´Ÿæ•°çš„æƒ…å†µ
- âŒ pageSizeè¿‡å¤§çš„æƒ…å†µ

**å¼‚å¸¸åœºæ™¯æµ‹è¯•ï¼ˆæœªè¦†ç›–ï¼‰**:
- âŒ CustomerIDä¸å­˜åœ¨
- âŒ WorkspaceIDä¸å­˜åœ¨
- âŒ WorkspaceIDä¸å±äºCustomerID
- âŒ åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„é…é¢
- âŒ æ›´æ–°é…é¢å°äºå·²ä½¿ç”¨èµ„æº
- âŒ é‡å¤åˆ›å»ºé…é¢ï¼ˆå¹¶å‘åœºæ™¯ï¼‰

**å¹¶å‘æµ‹è¯•ï¼ˆæœªè¦†ç›–ï¼‰**:
- âŒ å¤šä¸ªè¯·æ±‚åŒæ—¶æ£€æŸ¥é…é¢
- âŒ å¤šä¸ªè¯·æ±‚åŒæ—¶åˆ›å»ºé…é¢
- âŒ åŒæ—¶åˆ›å»ºå’Œæ›´æ–°é…é¢
- âŒ é…é¢æ£€æŸ¥ä¸ç¯å¢ƒåˆ›å»ºçš„ç«æ€æ¡ä»¶

**æ€§èƒ½æµ‹è¯•ï¼ˆæœªè¦†ç›–ï¼‰**:
- âŒ å¤§é‡ç¯å¢ƒæ—¶çš„èµ„æºç»Ÿè®¡æ€§èƒ½
- âŒ é«˜å¹¶å‘é…é¢æ£€æŸ¥æ€§èƒ½
- âŒ æ•°æ®åº“è¿æ¥æ± å‹åŠ›æµ‹è¯•

---

## ğŸ“ˆ Bugç»Ÿè®¡

### æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»

| ä¸¥é‡ç¨‹åº¦ | æ•°é‡ | Bugç¼–å· |
|---------|------|---------|
| ğŸ”´ Critical | 3 | #1, #2, #3 |
| ğŸŸ¡ High | 4 | #4, #5, #6, #7 |
| ğŸŸ¢ Medium | 7 | #8, #9, #10, #11, #12, #13, #14 |
| **æ€»è®¡** | **14** | |

### æŒ‰ç±»å‹åˆ†ç±»

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| é€»è¾‘é”™è¯¯ | 2 | Bug #1, #8 |
| å¹¶å‘å®‰å…¨ | 1 | Bug #2 |
| æ•°æ®å®Œæ•´æ€§ | 3 | Bug #3, #4, #12 |
| è¾¹ç•Œæ¡ä»¶ | 3 | Bug #5, #6, #10 |
| ä¸šåŠ¡é€»è¾‘ | 1 | Bug #7 |
| ä»£ç è´¨é‡ | 2 | Bug #11, #13 |
| å¯è§‚æµ‹æ€§ | 1 | Bug #14 |
| æ€§èƒ½ä¼˜åŒ– | 1 | Bug #9 |

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ P0 - å¿…é¡»ç«‹å³ä¿®å¤ï¼ˆé˜»å¡ä¸Šçº¿ï¼‰

**å½±å“**: åŠŸèƒ½ä¸æ­£ç¡®ï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡çš„èµ„æºè¶…é¢åˆ†é…

1. **Bug #1: GetUsedResourcesé€»è¾‘é”™è¯¯**
   - é¢„è®¡ä¿®å¤æ—¶é—´: 1å°æ—¶
   - é£é™©: ä½ï¼ˆé€»è¾‘ç®€å•ï¼‰
   - ä¾èµ–: æ— 

2. **Bug #2: å¹¶å‘ç«æ€æ¡ä»¶**
   - é¢„è®¡ä¿®å¤æ—¶é—´: 4-8å°æ—¶
   - é£é™©: ä¸­ï¼ˆéœ€è¦ä»”ç»†è®¾è®¡é”æœºåˆ¶ï¼‰
   - ä¾èµ–: å¯èƒ½éœ€è¦å¼•å…¥Redis

3. **Bug #3: ç¼ºå°‘å”¯ä¸€æ€§çº¦æŸ**
   - é¢„è®¡ä¿®å¤æ—¶é—´: 2å°æ—¶
   - é£é™©: ä¸­ï¼ˆéœ€è¦æ•°æ®åº“è¿ç§»ï¼‰
   - ä¾èµ–: éœ€è¦å¤„ç†ç°æœ‰é‡å¤æ•°æ®

**å»ºè®®**: åœ¨ä¿®å¤è¿™3ä¸ªP0 bugä¹‹å‰ï¼Œä¸åº”è¯¥å°†æ­¤æ¨¡å—éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

---

## âœ… éªŒæ”¶æ ‡å‡†

ä¿®å¤å®Œæˆåï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ ‡å‡†æ‰èƒ½é€šè¿‡éªŒæ”¶ï¼š

### åŠŸèƒ½æ­£ç¡®æ€§
- [ ] GetUsedResourcesæ­£ç¡®ç»Ÿè®¡æ‰€æœ‰ç¯å¢ƒçš„èµ„æºä½¿ç”¨
- [ ] å¹¶å‘åœºæ™¯ä¸‹é…é¢æ£€æŸ¥ä¸ä¼šè¶…é¢åˆ†é…
- [ ] ä¸èƒ½åˆ›å»ºé‡å¤çš„é…é¢è®°å½•
- [ ] æ‰€æœ‰å¤–é”®å¼•ç”¨éƒ½æ˜¯æœ‰æ•ˆçš„

### æ•°æ®å®Œæ•´æ€§
- [ ] æ•°æ®åº“æœ‰å”¯ä¸€æ€§çº¦æŸ
- [ ] ä¸èƒ½æ›´æ–°é…é¢å°äºå·²ä½¿ç”¨èµ„æº
- [ ] ä¸èƒ½åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„é…é¢
- [ ] å¯ç”¨é…é¢ä¸ä¼šä¸ºè´Ÿæ•°

### æµ‹è¯•è¦†ç›–
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] åŒ…å«è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- [ ] åŒ…å«å¼‚å¸¸åœºæ™¯æµ‹è¯•
- [ ] åŒ…å«å¹¶å‘æµ‹è¯•
- [ ] åŒ…å«æ€§èƒ½æµ‹è¯•

---

**æŠ¥å‘Šå®Œæˆæ—¥æœŸ**: 2026-01-30
**æ•´ä½“é£é™©ç­‰çº§**: ğŸ”´ é«˜é£é™©
**å»ºè®®**: å¿…é¡»ä¿®å¤æ‰€æœ‰P0çº§åˆ«bugåæ‰èƒ½éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

