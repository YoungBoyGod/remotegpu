# 员工G - 任务分配（测试工程师）

## 基本信息
- **负责人**: 员工G
- **主要职责**: 质量保证、测试用例设计、自动化测试
- **预估工时**: 25小时
- **优先级**: P0（最高）
- **开始时间**: 第1周
- **依赖**: 部分依赖开发人员完成功能

---

## 角色定位

你是团队的**质量守护者**,负责:
1. 确保代码质量达标
2. 设计和编写测试用例
3. 执行各类测试(单元、集成、端到端)
4. 跟踪和验证Bug
5. 生成测试报告
6. 与开发人员协作改进代码质量

**特点**:
- 需要对业务逻辑有深入理解
- 需要掌握测试框架和工具
- 需要有良好的沟通能力
- 部分工作可以提前准备

---

## 任务概述

### 阶段1: 测试框架搭建（可立即开始）
- 测试环境配置
- 测试框架选型和配置
- 测试数据准备
- Mock工具配置

### 阶段2: 单元测试支持（跟随开发）
- 协助开发人员编写单元测试
- 审查单元测试质量
- 确保测试覆盖率>80%

### 阶段3: 集成测试（DAO层完成后）
- 数据库集成测试
- API集成测试
- 业务流程测试

### 阶段4: 端到端测试（系统完成后）
- 完整业务流程测试
- 性能测试
- 压力测试

---

## 详细任务列表

### 阶段1: 测试框架搭建（6小时，可立即开始）

#### Task G.1.1: 测试环境配置（2小时）

<thinking>
我需要为测试员工设计详细的任务。测试环境配置应该包括:
- 测试数据库配置
- 测试配置文件
- 测试数据准备脚本
- Mock服务配置

我应该保持任务的细节性和可执行性。
</thinking>

**目标**: 搭建独立的测试环境

**Subtask清单**:
- [ ] 配置测试数据库（1小时）
  - 创建测试数据库: `remotegpu_test`
  - 配置测试数据库连接
  - 编写数据库清理脚本
  ```bash
  # scripts/test_db_setup.sh
  createdb -U remotegpu_user remotegpu_test
  psql -U remotegpu_user -d remotegpu_test -f sql/01_init.sql
  # ... 执行所有SQL文件
  ```

- [ ] 创建测试配置文件（30分钟）
  - `config/config.test.yaml`
  - 配置测试数据库连接
  - 配置测试端口(避免冲突)

- [ ] 编写测试数据准备脚本（30分钟）
  - `scripts/test_data_seed.sh`
  - 创建测试用户
  - 创建测试工作空间
  - 创建测试主机和GPU

**验收标准**:
- [ ] 测试数据库可用
- [ ] 测试配置正确
- [ ] 测试数据脚本可用

---

#### Task G.1.2: 测试框架配置（2小时）

**目标**: 配置Go测试框架和工具

**Subtask清单**:
- [ ] 安装测试工具（30分钟）
  ```bash
  # 安装testify断言库
  go get github.com/stretchr/testify

  # 安装gomock
  go get github.com/golang/mock/gomock
  go install github.com/golang/mock/mockgen@latest

  # 安装测试覆盖率工具
  go get github.com/axw/gocov/gocov
  ```

- [ ] 配置测试辅助函数（1小时）
  - 创建`internal/testutil/`目录
  - 实现数据库测试辅助函数
  - 实现HTTP测试辅助函数
  ```go
  // internal/testutil/db.go
  func SetupTestDB() *gorm.DB { ... }
  func CleanupTestDB(db *gorm.DB) { ... }

  // internal/testutil/http.go
  func NewTestRouter() *gin.Engine { ... }
  func MakeRequest(method, url string, body interface{}) *httptest.ResponseRecorder { ... }
  ```

- [ ] 编写测试模板（30分钟）
  - 单元测试模板
  - 集成测试模板

**验收标准**:
- [ ] 测试工具安装完成
- [ ] 测试辅助函数可用
- [ ] 测试模板可用

---

#### Task G.1.3: Mock工具配置（2小时）

**目标**: 配置Mock工具,支持单元测试

**Subtask清单**:
- [ ] 为DAO层生成Mock（1小时）
  ```bash
  # 为每个DAO生成Mock
  mockgen -source=internal/dao/workspace.go -destination=internal/dao/mock/workspace_mock.go
  mockgen -source=internal/dao/customer.go -destination=internal/dao/mock/customer_mock.go
  # ... 其他DAO
  ```

- [ ] 为Service层生成Mock（30分钟）
  ```bash
  mockgen -source=internal/service/workspace.go -destination=internal/service/mock/workspace_mock.go
  # ... 其他Service
  ```

- [ ] 编写Mock使用示例（30分钟）
  - 创建Mock使用文档
  - 编写示例测试用例

**验收标准**:
- [ ] Mock文件生成成功
- [ ] Mock可以正常使用
- [ ] 示例测试通过

---

### 阶段2: 单元测试支持（8小时，跟随开发）

#### Task G.2.1: DAO层测试审查（4小时）

**目标**: 审查和改进DAO层的单元测试

**Subtask清单**:
- [ ] 审查员工A的测试（1小时）
  - WorkspaceDao测试
  - WorkspaceMemberDao测试
  - 检查测试覆盖率
  - 提出改进建议

- [ ] 审查员工B的测试（30分钟）
  - ResourceQuotaDao测试

- [ ] 审查员工C的测试（1小时）
  - HostDao测试

- [ ] 审查员工D的测试（1小时）
  - GPUDao测试
  - 重点检查并发测试

- [ ] 审查员工E的测试（30分钟）
  - EnvironmentDao测试
  - PortMappingDao测试

**验收标准**:
- [ ] 所有DAO测试覆盖率>80%
- [ ] 测试用例完整
- [ ] 边界条件测试充分

---

#### Task G.2.2: Service层测试支持（4小时）

**目标**: 协助员工F编写Service层测试

**Subtask清单**:
- [ ] 编写WorkspaceService测试（1小时）
  - 使用Mock DAO
  - 测试业务逻辑
  - 测试权限检查

- [ ] 编写EnvironmentService测试（1.5小时）
  - 测试环境创建流程
  - 测试事务回滚
  - 测试资源分配

- [ ] 编写其他Service测试（1小时）
  - ResourceQuotaService
  - HostService
  - GPUService

- [ ] 生成测试覆盖率报告（30分钟）
  ```bash
  go test ./... -coverprofile=coverage.out
  go tool cover -html=coverage.out -o coverage.html
  ```

**验收标准**:
- [ ] Service层测试覆盖率>80%
- [ ] 业务逻辑测试完整
- [ ] 测试报告生成

---

### 阶段3: 集成测试（6小时，DAO层完成后）

#### Task G.3.1: 数据库集成测试（2小时）

**目标**: 测试数据库操作的正确性

**Subtask清单**:
- [ ] 测试外键约束（30分钟）
  - 测试级联删除
  - 测试外键冲突

- [ ] 测试唯一约束（30分钟）
  - 测试重复插入
  - 测试唯一索引

- [ ] 测试事务（1小时）
  - 测试事务提交
  - 测试事务回滚
  - 测试并发事务

**验收标准**:
- [ ] 数据库约束正确
- [ ] 事务处理正确
- [ ] 并发安全

---

#### Task G.3.2: API集成测试（2小时）

**目标**: 测试API接口的正确性

**Subtask清单**:
- [ ] 测试用户API（30分钟）
  - 注册、登录、获取信息

- [ ] 测试工作空间API（30分钟）
  - CRUD操作
  - 成员管理

- [ ] 测试环境API（1小时）
  - 创建、启动、停止、删除
  - 错误场景测试

**验收标准**:
- [ ] API接口功能正确
- [ ] 错误处理完善
- [ ] 响应格式正确

---

#### Task G.3.3: 业务流程测试（2小时）

**目标**: 测试完整的业务流程

**Subtask清单**:
- [ ] 测试用户注册到创建环境流程（1小时）
  - 用户注册
  - 创建工作空间
  - 创建环境
  - 启动环境

- [ ] 测试配额检查流程（30分钟）
  - 创建环境时检查配额
  - 配额不足时拒绝创建

- [ ] 测试资源分配流程（30分钟）
  - 主机选择
  - GPU分配
  - 端口分配

**验收标准**:
- [ ] 业务流程完整
- [ ] 异常场景处理正确

---

### 阶段4: 端到端测试（5小时，系统完成后）

#### Task G.4.1: 完整业务流程测试（2小时）

**Subtask清单**:
- [ ] 测试完整用户旅程（1小时）
  - 从注册到使用环境的完整流程

- [ ] 测试管理员功能（1小时）
  - 用户管理
  - 资源管理
  - 系统监控

**验收标准**:
- [ ] 端到端测试通过
- [ ] 用户体验流畅

---

#### Task G.4.2: 性能测试（2小时）

**Subtask清单**:
- [ ] API性能测试（1小时）
  - 使用ab或wrk工具
  - 测试关键API的响应时间
  - 目标: 95%请求<200ms

- [ ] 数据库性能测试（1小时）
  - 测试慢查询
  - 优化建议

**验收标准**:
- [ ] 性能达标
- [ ] 性能报告生成

---

#### Task G.4.3: 压力测试（1小时）

**Subtask清单**:
- [ ] 并发用户测试（30分钟)
  - 模拟100并发用户
  - 测试系统稳定性

- [ ] 资源竞争测试（30分钟）
  - 测试GPU并发分配
  - 测试端口并发分配

**验收标准**:
- [ ] 系统在压力下稳定
- [ ] 无资源竞争问题

---

## 日常工作

### 每日任务
- [ ] 审查当天的代码提交（30分钟）
- [ ] 运行完整测试套件（15分钟）
- [ ] 更新测试报告（15分钟）
- [ ] 跟踪Bug状态（15分钟）

### 每周任务
- [ ] 生成周测试报告（1小时）
- [ ] 测试覆盖率分析（30分钟）
- [ ] 测试用例维护（1小时）

---

## 测试工具和技术

### 测试框架
- **Go testing**: 标准测试框架
- **testify**: 断言库
- **gomock**: Mock框架
- **httptest**: HTTP测试

### 测试工具
- **gocov**: 测试覆盖率
- **ab/wrk**: 性能测试
- **Postman**: API测试

### CI集成
- 与员工H(DevOps)协作
- 集成测试到CI/CD流程

---

## 协作和依赖

### 依赖其他员工的工作
- **所有开发人员**: 需要他们完成功能后才能测试
- **员工H(DevOps)**: 需要CI/CD环境

### 其他员工依赖你的工作
- **所有开发人员**: 依赖你的测试反馈
- **员工H(DevOps)**: 依赖你的测试脚本

### 协作点
- 与**开发人员**协作: 提供测试反馈,协助改进代码
- 与**员工H**协作: 集成测试到CI/CD

---

## 验收检查清单

### 测试环境
- [ ] 测试数据库配置完成
- [ ] 测试框架配置完成
- [ ] Mock工具可用

### 测试覆盖率
- [ ] DAO层覆盖率>80%
- [ ] Service层覆盖率>80%
- [ ] Controller层覆盖率>70%

### 测试类型
- [ ] 单元测试完整
- [ ] 集成测试完整
- [ ] 端到端测试完整
- [ ] 性能测试完成

### 文档
- [ ] 测试报告生成
- [ ] 测试用例文档完整

---

## Bug跟踪流程

### Bug发现
1. 在测试中发现Bug
2. 记录Bug详细信息
3. 在团队协作文档中记录
4. 通知相关开发人员

### Bug验证
1. 开发人员修复Bug
2. 验证修复是否有效
3. 回归测试
4. 关闭Bug

---

## 测试报告模板

### 日报
```
日期: 2026-01-28
测试人员: 员工G

今日测试:
- 测试模块: WorkspaceDao
- 测试用例数: 15
- 通过: 14
- 失败: 1

发现问题:
- Bug #1: Workspace删除时未级联删除成员

测试覆盖率:
- DAO层: 82%
- Service层: 75%
```

### 周报
```
周次: 第1周
测试人员: 员工G

本周完成:
- 测试环境搭建
- DAO层测试审查
- 发现并跟踪5个Bug

测试覆盖率:
- 整体: 78%
- DAO层: 85%
- Service层: 70%

下周计划:
- Service层测试
- 集成测试
```

---

## 注意事项

1. **测试独立性**: 测试之间不应相互依赖
2. **测试数据清理**: 每个测试后清理数据
3. **测试可重复性**: 测试结果应该可重复
4. **测试文档**: 及时更新测试文档
5. **沟通**: 及时反馈测试结果

---

## 进度报告

请在完成每个Task后更新`团队协作文档.md`。

---

## 联系方式

遇到问题请联系:
- 所有开发人员(测试反馈)
- 员工H(DevOps协作)
- 项目经理(汇报进度)
