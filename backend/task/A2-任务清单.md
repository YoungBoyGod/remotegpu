# A2 - ResourceQuota ç®¡ç†æ¨¡å—ä»»åŠ¡æ¸…å•

## ğŸ‘¤ åŸºæœ¬ä¿¡æ¯

**å‘˜å·¥ç¼–å·**: A2
**è´Ÿè´£æ¨¡å—**: ResourceQuota ç®¡ç†
**ä¼˜å…ˆçº§**: P0ï¼ˆæœ€é«˜ï¼‰
**é¢„ä¼°æ€»å·¥æ—¶**: 12 å°æ—¶
**å¼€å§‹æ—¥æœŸ**: 2026-01-30
**é¢„è®¡å®Œæˆ**: 2026-02-01

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

è´Ÿè´£å®ç° ResourceQuotaï¼ˆèµ„æºé…é¢ï¼‰çš„å®Œæ•´åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- å®ä½“æ¨¡å‹è®¾è®¡å’Œå®ç°
- æ•°æ®è®¿é—®å±‚ï¼ˆDaoï¼‰å®ç°
- ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰å®ç°
- é…é¢æ£€æŸ¥å’Œèµ„æºç»Ÿè®¡é€»è¾‘
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

**é‡è¦æ€§**: ResourceQuota æ˜¯ç¯å¢ƒåˆ›å»ºçš„å‰ç½®æ£€æŸ¥ï¼ŒA6 çš„ç¯å¢ƒåˆ›å»ºé€»è¾‘ä¾èµ–æ­¤æ¨¡å—ã€‚

---

## ğŸ¯ äº¤ä»˜ç›®æ ‡

### å¿…é¡»äº¤ä»˜
- [ ] ResourceQuota å®ä½“æ¨¡å‹
- [ ] ResourceQuotaDaoï¼ˆå®Œæ•´ CRUDï¼‰
- [ ] ResourceQuotaServiceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- [ ] é…é¢æ£€æŸ¥é€»è¾‘
- [ ] èµ„æºç»Ÿè®¡é€»è¾‘
- [ ] å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰
- [ ] é›†æˆæµ‹è¯•
- [ ] API æ–‡æ¡£

### è´¨é‡æ ‡å‡†
- ä»£ç ç¬¦åˆ Go è§„èŒƒ
- æ‰€æœ‰å…¬å¼€æ–¹æ³•æœ‰æ³¨é‡Š
- é”™è¯¯å¤„ç†å®Œå–„
- æµ‹è¯•è¦†ç›–ç‡ > 80%
- é€šè¿‡ä»£ç å®¡æŸ¥

---

## ğŸ“ è¯¦ç»†ä»»åŠ¡åˆ†è§£

### Task 2.1: ResourceQuota å®ä½“æ¨¡å‹ â¸ï¸

**é¢„ä¼°å·¥æ—¶**: 2 å°æ—¶
**ä¼˜å…ˆçº§**: P0
**ä¾èµ–**: A1 å®Œæˆ Workspace å®ä½“ï¼ˆTask 1.1ï¼‰
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

#### å­ä»»åŠ¡

**2.1.1 åˆ›å»ºæ–‡ä»¶å’ŒåŸºç¡€ç»“æ„** (0.5h)
- [ ] åˆ›å»ºæ–‡ä»¶ `internal/model/entity/resource_quota.go`
- [ ] æ·»åŠ  package å£°æ˜å’Œå¿…è¦çš„ import
- [ ] å®šä¹‰ ResourceQuota ç»“æ„ä½“åŸºç¡€æ¡†æ¶
- [ ] å‚è€ƒ SQL: `sql/03_users_and_permissions.sql`

**2.1.2 å®šä¹‰å­—æ®µå’Œ GORM æ ‡ç­¾** (0.5h)
- [ ] æ·»åŠ æ‰€æœ‰å­—æ®µï¼š
  - ID (uint, ä¸»é”®)
  - CustomerID (uint, å¤–é”®)
  - WorkspaceID (uint, å¤–é”®, å¯ä¸ºç©º)
  - CPU (int) - CPU æ ¸å¿ƒæ•°é…é¢
  - Memory (int64) - å†…å­˜é…é¢ï¼ˆMBï¼‰
  - GPU (int) - GPU æ•°é‡é…é¢
  - Storage (int64) - å­˜å‚¨é…é¢ï¼ˆGBï¼‰
  - CreatedAt, UpdatedAt
- [ ] æ·»åŠ  GORM æ ‡ç­¾ï¼ˆä¸»é”®ã€ç´¢å¼•ã€å¤–é”®ï¼‰
- [ ] æ·»åŠ  JSON æ ‡ç­¾
- [ ] æ·»åŠ å…³è”å…³ç³»ï¼ˆCustomer, Workspaceï¼‰
- [ ] å®ç° TableName() æ–¹æ³•è¿”å› "resource_quotas"

**2.1.3 ç¼–å†™å•å…ƒæµ‹è¯•** (1h)
- [ ] åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `resource_quota_test.go`
- [ ] æµ‹è¯•ç»“æ„ä½“åˆ›å»º
- [ ] æµ‹è¯• TableName æ–¹æ³•
- [ ] æµ‹è¯• GORM æ ‡ç­¾æ­£ç¡®æ€§
- [ ] æµ‹è¯•å…³è”å…³ç³»

#### éªŒæ”¶æ ‡å‡†
- [ ] æ–‡ä»¶åˆ›å»ºæˆåŠŸ
- [ ] æ‰€æœ‰å­—æ®µå®šä¹‰æ­£ç¡®
- [ ] GORM æ ‡ç­¾å®Œæ•´
- [ ] å…³è”å…³ç³»æ­£ç¡®
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] ä»£ç æ ¼å¼åŒ–ï¼ˆgo fmtï¼‰
- [ ] ä»£ç æ£€æŸ¥é€šè¿‡ï¼ˆgo vetï¼‰

#### æµ‹è¯•å‘½ä»¤
```bash
go test -v ./internal/model/entity -run TestResourceQuota
go test -cover ./internal/model/entity -run TestResourceQuota
```

#### Git æäº¤
```bash
git add internal/model/entity/resource_quota.go
git add internal/model/entity/resource_quota_test.go
git commit -m "[ResourceQuota] æ·»åŠ  ResourceQuota å®ä½“æ¨¡å‹

- åˆ›å»º ResourceQuota ç»“æ„ä½“
- æ·»åŠ æ‰€æœ‰å¿…éœ€å­—æ®µå’Œ GORM æ ‡ç­¾
- æ·»åŠ ä¸ Customer å’Œ Workspace çš„å…³è”å…³ç³»
- å®ç° TableName æ–¹æ³•
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: XX%
"
```

---

### Task 2.2: ResourceQuotaDao â¸ï¸

**é¢„ä¼°å·¥æ—¶**: 4 å°æ—¶
**ä¼˜å…ˆçº§**: P0
**ä¾èµ–**: Task 2.1
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

#### å­ä»»åŠ¡

**2.2.1 åˆ›å»ºåŸºç¡€ç»“æ„** (0.5h)
- [ ] åˆ›å»ºæ–‡ä»¶ `internal/dao/resource_quota.go`
- [ ] å®šä¹‰ ResourceQuotaDao ç»“æ„ä½“
- [ ] å®ç° NewResourceQuotaDao() æ„é€ å‡½æ•°
- [ ] æ·»åŠ åŒ…æ³¨é‡Šå’Œæ–‡æ¡£

**2.2.2 å®ç° CRUD æ–¹æ³•** (2h)
- [ ] Create(quota *entity.ResourceQuota) error
- [ ] GetByID(id uint) (*entity.ResourceQuota, error)
- [ ] GetByCustomerID(customerID uint) (*entity.ResourceQuota, error)
- [ ] GetByWorkspaceID(workspaceID uint) (*entity.ResourceQuota, error)
- [ ] Update(quota *entity.ResourceQuota) error
- [ ] Delete(id uint) error
- [ ] æ·»åŠ é”™è¯¯å¤„ç†

**2.2.3 å®ç°æŸ¥è¯¢æ–¹æ³•** (0.5h)
- [ ] List(page, pageSize int) ([]*entity.ResourceQuota, int64, error)
- [ ] GetByCustomerAndWorkspace(customerID, workspaceID uint) (*entity.ResourceQuota, error)

**2.2.4 ç¼–å†™å•å…ƒæµ‹è¯•** (1h)
- [ ] åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `resource_quota_test.go`
- [ ] æµ‹è¯•æ‰€æœ‰ CRUD æ–¹æ³•
- [ ] æµ‹è¯•æŸ¥è¯¢æ–¹æ³•
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†
- [ ] ä½¿ç”¨æµ‹è¯•æ•°æ®åº“

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰æ–¹æ³•å®ç°æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%

#### Git æäº¤
```bash
git add internal/dao/resource_quota.go
git add internal/dao/resource_quota_test.go
git commit -m "[ResourceQuota] å®ç° ResourceQuotaDao

- å®ç°å®Œæ•´çš„ CRUD æ–¹æ³•
- å®ç°æŸ¥è¯¢æ–¹æ³•ï¼ˆæŒ‰ Customerã€Workspaceã€åˆ†é¡µï¼‰
- æ·»åŠ é”™è¯¯å¤„ç†
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: XX%
"
```

---

### Task 2.3: ResourceQuotaService â¸ï¸

**é¢„ä¼°å·¥æ—¶**: 4 å°æ—¶
**ä¼˜å…ˆçº§**: P0
**ä¾èµ–**: Task 2.2
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

#### å­ä»»åŠ¡

**2.3.1 å®ç°é…é¢è®¾ç½®** (1h)
- [ ] åˆ›å»ºæ–‡ä»¶ `internal/service/resource_quota.go`
- [ ] å®šä¹‰ ResourceQuotaService ç»“æ„ä½“
- [ ] SetQuota(quota *entity.ResourceQuota) error
- [ ] GetQuota(customerID uint, workspaceID *uint) (*entity.ResourceQuota, error)
- [ ] UpdateQuota(quota *entity.ResourceQuota) error
- [ ] DeleteQuota(id uint) error

**2.3.2 å®ç°é…é¢æ£€æŸ¥** (1.5h)
- [ ] å®šä¹‰ ResourceRequest ç»“æ„ä½“ï¼ˆCPU, Memory, GPU, Storageï¼‰
- [ ] CheckQuota(customerID uint, workspaceID *uint, request *ResourceRequest) (bool, error)
- [ ] å®ç°é…é¢æ¯”è¾ƒé€»è¾‘
- [ ] è€ƒè™‘å·²ä½¿ç”¨èµ„æº
- [ ] è¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ˆå“ªä¸ªèµ„æºè¶…é…é¢ï¼‰

**2.3.3 å®ç°èµ„æºç»Ÿè®¡** (0.5h)
- [ ] å®šä¹‰ UsedResources ç»“æ„ä½“
- [ ] GetUsedResources(customerID uint, workspaceID *uint) (*UsedResources, error)
- [ ] æŸ¥è¯¢æ‰€æœ‰è¿è¡Œä¸­çš„ç¯å¢ƒ
- [ ] ç»Ÿè®¡ CPUã€Memoryã€GPUã€Storage ä½¿ç”¨é‡
- [ ] GetAvailableQuota(customerID uint, workspaceID *uint) (*ResourceQuota, error)

**2.3.4 ç¼–å†™å•å…ƒæµ‹è¯•** (1h)
- [ ] åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `resource_quota_test.go`
- [ ] æµ‹è¯•é…é¢è®¾ç½®
- [ ] æµ‹è¯•é…é¢æ£€æŸ¥ï¼ˆè¶³å¤Ÿã€ä¸è¶³ã€åˆšå¥½ï¼‰
- [ ] æµ‹è¯•èµ„æºç»Ÿè®¡
- [ ] æµ‹è¯•è¾¹ç•Œæ¡ä»¶

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰ä¸šåŠ¡é€»è¾‘æ­£ç¡®
- [ ] é…é¢æ£€æŸ¥å‡†ç¡®
- [ ] èµ„æºç»Ÿè®¡æ­£ç¡®
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%

#### Git æäº¤
```bash
git add internal/service/resource_quota.go
git add internal/service/resource_quota_test.go
git commit -m "[ResourceQuota] å®ç° ResourceQuotaService

- å®ç°é…é¢è®¾ç½®å’ŒæŸ¥è¯¢
- å®ç°é…é¢æ£€æŸ¥é€»è¾‘
- å®ç°èµ„æºç»Ÿè®¡åŠŸèƒ½
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: XX%
"
```

---

### Task 2.4: é›†æˆæµ‹è¯• â¸ï¸

**é¢„ä¼°å·¥æ—¶**: 2 å°æ—¶
**ä¼˜å…ˆçº§**: P0
**ä¾èµ–**: Task 2.3
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

#### å­ä»»åŠ¡

**2.4.1 é…é¢æ£€æŸ¥æµç¨‹æµ‹è¯•** (1h)
- [ ] åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `internal/service/resource_quota_integration_test.go`
- [ ] æµ‹è¯•åœºæ™¯1ï¼šè®¾ç½®é…é¢ â†’ æ£€æŸ¥é…é¢ï¼ˆè¶³å¤Ÿï¼‰â†’ åˆ›å»ºç¯å¢ƒ
- [ ] æµ‹è¯•åœºæ™¯2ï¼šè®¾ç½®é…é¢ â†’ æ£€æŸ¥é…é¢ï¼ˆä¸è¶³ï¼‰â†’ æ‹’ç»åˆ›å»º
- [ ] æµ‹è¯•åœºæ™¯3ï¼šå¤šæ¬¡åˆ›å»ºç¯å¢ƒ â†’ é…é¢é€æ¸å‡å°‘ â†’ æœ€ç»ˆä¸è¶³

**2.4.2 èµ„æºç»Ÿè®¡æµ‹è¯•** (1h)
- [ ] æµ‹è¯•åœºæ™¯1ï¼šæ— ç¯å¢ƒ â†’ å·²ä½¿ç”¨èµ„æºä¸º0
- [ ] æµ‹è¯•åœºæ™¯2ï¼šåˆ›å»ºç¯å¢ƒ â†’ å·²ä½¿ç”¨èµ„æºå¢åŠ 
- [ ] æµ‹è¯•åœºæ™¯3ï¼šåˆ é™¤ç¯å¢ƒ â†’ å·²ä½¿ç”¨èµ„æºå‡å°‘
- [ ] æµ‹è¯•åœºæ™¯4ï¼šå¤šä¸ªå·¥ä½œç©ºé—´ â†’ åˆ†åˆ«ç»Ÿè®¡

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ä¸»è¦ä¸šåŠ¡æµç¨‹
- [ ] æµ‹è¯•æ•°æ®æ¸…ç†å®Œæ•´

#### Git æäº¤
```bash
git add internal/service/resource_quota_integration_test.go
git commit -m "[ResourceQuota] æ·»åŠ é›†æˆæµ‹è¯•

- æµ‹è¯•é…é¢æ£€æŸ¥æµç¨‹
- æµ‹è¯•èµ„æºç»Ÿè®¡åŠŸèƒ½
- æµ‹è¯•å¤šç§ä¸šåŠ¡åœºæ™¯
"
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

**æµ‹è¯•æ–‡ä»¶ä½ç½®**:
- `internal/model/entity/resource_quota_test.go`
- `internal/dao/resource_quota_test.go`
- `internal/service/resource_quota_test.go`

**æµ‹è¯•è¦†ç›–**:
- æ‰€æœ‰å…¬å¼€æ–¹æ³•
- é…é¢æ£€æŸ¥çš„å„ç§æƒ…å†µï¼ˆè¶³å¤Ÿã€ä¸è¶³ã€åˆšå¥½ï¼‰
- èµ„æºç»Ÿè®¡çš„å‡†ç¡®æ€§
- é”™è¯¯å¤„ç†è·¯å¾„
- è¾¹ç•Œæ¡ä»¶ï¼ˆé…é¢ä¸º0ã€è´Ÿæ•°ç­‰ï¼‰

**è¿è¡Œå‘½ä»¤**:
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test -v ./internal/model/entity ./internal/dao ./internal/service

# æ£€æŸ¥è¦†ç›–ç‡
go test -cover ./internal/model/entity ./internal/dao ./internal/service

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -coverprofile=coverage.out ./internal/...
go tool cover -html=coverage.out
```

### é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
1. è®¾ç½®é…é¢ â†’ æ£€æŸ¥é…é¢ â†’ åˆ›å»ºç¯å¢ƒ â†’ ç»Ÿè®¡èµ„æº
2. é…é¢ä¸è¶³åœºæ™¯
3. å¤šå·¥ä½œç©ºé—´é…é¢ç®¡ç†
4. å¹¶å‘é…é¢æ£€æŸ¥

**æµ‹è¯•æ•°æ®åº“**:
- ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“
- æ¯æ¬¡æµ‹è¯•åæ¸…ç†æ•°æ®
- ä¸è¦ä½¿ç”¨ç”Ÿäº§æ•°æ®

---

## ğŸ“¦ ä¾èµ–å…³ç³»

### è¾“å…¥ä¾èµ–
- â³ A1: Workspace å®ä½“ï¼ˆTask 1.1ï¼‰- éœ€è¦ WorkspaceID å¤–é”®
- âœ… Customer æ¨¡å‹ï¼ˆå·²å®Œæˆï¼‰
- âœ… æ•°æ®åº“è¿æ¥ï¼ˆå·²å®Œæˆï¼‰

### è¾“å‡ºä¾èµ–ï¼ˆå…¶ä»–äººä¾èµ–ä½ ï¼‰
- â†’ A6: ç¯å¢ƒåˆ›å»ºéœ€è¦è°ƒç”¨ CheckQuota æ–¹æ³•

**é‡è¦**:
- ç­‰å¾… A1 å®Œæˆ Task 1.1 åå†å¼€å§‹ Task 2.1
- å®Œæˆ Task 2.3 åç«‹å³é€šçŸ¥ A6ï¼

---

## ğŸ”„ å¼€å‘æµç¨‹

### æ¯ä¸ªä»»åŠ¡çš„æ ‡å‡†æµç¨‹

1. **å¼€å§‹ä»»åŠ¡**
   - åœ¨è¿›åº¦æ–‡æ¡£ä¸­æ›´æ–°çŠ¶æ€ä¸º "ğŸ”„ è¿›è¡Œä¸­"
   - åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/resource-quota-xxx`

2. **ç¼–å†™ä»£ç **
   - æŒ‰ç…§å­ä»»åŠ¡é€æ­¥å®ç°
   - éµå¾ª Go ä»£ç è§„èŒƒ
   - æ·»åŠ å¿…è¦çš„æ³¨é‡Š

3. **ç¼–å†™æµ‹è¯•**
   - å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
   - æµ‹è¯•æ‰€æœ‰å…¬å¼€æ–¹æ³•
   - æµ‹è¯•é”™è¯¯å¤„ç†

4. **è¿è¡Œæµ‹è¯•**
   ```bash
   go fmt ./...
   go vet ./...
   go test -v ./internal/...
   ```

5. **æäº¤ä»£ç **
   - æŒ‰ç…§æäº¤è§„èŒƒç¼–å†™æäº¤ä¿¡æ¯
   - æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯
   - åˆ›å»º Pull Request

6. **ä»£ç å®¡æŸ¥**
   - ç­‰å¾…è‡³å°‘ä¸€äººå®¡æŸ¥
   - æ ¹æ®åé¦ˆä¿®æ”¹ä»£ç 
   - å®¡æŸ¥é€šè¿‡ååˆå¹¶

7. **æ›´æ–°è¿›åº¦**
   - åœ¨è¿›åº¦æ–‡æ¡£ä¸­æ ‡è®°ä»»åŠ¡ä¸º "âœ… å·²å®Œæˆ"
   - æ›´æ–°å·¥æ—¶ç»Ÿè®¡
   - é€šçŸ¥ä¾èµ–æ–¹ï¼ˆA6ï¼‰

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

### ä»»åŠ¡è¿›åº¦

| ä»»åŠ¡ | çŠ¶æ€ | å¼€å§‹æ—¶é—´ | å®Œæˆæ—¶é—´ | å®é™…å·¥æ—¶ |
|------|------|----------|----------|----------|
| Task 2.1: ResourceQuota å®ä½“ | â¸ï¸ å¾…å¼€å§‹ | - | - | 0h |
| Task 2.2: ResourceQuotaDao | â¸ï¸ å¾…å¼€å§‹ | - | - | 0h |
| Task 2.3: ResourceQuotaService | â¸ï¸ å¾…å¼€å§‹ | - | - | 0h |
| Task 2.4: é›†æˆæµ‹è¯• | â¸ï¸ å¾…å¼€å§‹ | - | - | 0h |

**æ€»è¿›åº¦**: 0/4 (0%)

### å·¥æ—¶ç»Ÿè®¡

- **è®¡åˆ’å·¥æ—¶**: 12 å°æ—¶
- **å·²ç”¨å·¥æ—¶**: 0 å°æ—¶
- **å‰©ä½™å·¥æ—¶**: 12 å°æ—¶

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼€å‘è§„èŒƒ

1. **é…é¢å•ä½**
   - CPU: æ ¸å¿ƒæ•°ï¼ˆæ•´æ•°ï¼‰
   - Memory: MBï¼ˆint64ï¼‰
   - GPU: æ•°é‡ï¼ˆæ•´æ•°ï¼‰
   - Storage: GBï¼ˆint64ï¼‰

2. **é…é¢æ£€æŸ¥é€»è¾‘**
   - å¿…é¡»è€ƒè™‘å·²ä½¿ç”¨èµ„æº
   - å¯ç”¨é…é¢ = æ€»é…é¢ - å·²ä½¿ç”¨
   - æ£€æŸ¥æ—¶ä½¿ç”¨æ‚²è§‚é”ï¼ˆFOR UPDATEï¼‰é˜²æ­¢å¹¶å‘é—®é¢˜

3. **èµ„æºç»Ÿè®¡**
   - åªç»Ÿè®¡è¿è¡Œä¸­çš„ç¯å¢ƒï¼ˆstatus = 'running'ï¼‰
   - ä¸ç»Ÿè®¡å·²åœæ­¢æˆ–å·²åˆ é™¤çš„ç¯å¢ƒ
   - è€ƒè™‘è½¯åˆ é™¤çš„ç¯å¢ƒ

4. **é”™è¯¯å¤„ç†**
   - é…é¢ä¸è¶³æ—¶è¿”å›è¯¦ç»†ä¿¡æ¯ï¼ˆå“ªä¸ªèµ„æºä¸è¶³ï¼Œå·®å¤šå°‘ï¼‰
   - ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼ˆQuotaExceededErrorï¼‰

### å¸¸è§é—®é¢˜

**Q: WorkspaceID ä¸ºç©ºè¡¨ç¤ºä»€ä¹ˆï¼Ÿ**
A: ä¸ºç©ºè¡¨ç¤ºç”¨æˆ·çº§åˆ«çš„é…é¢ï¼Œä¸ä¸ºç©ºè¡¨ç¤ºå·¥ä½œç©ºé—´çº§åˆ«çš„é…é¢ã€‚

**Q: å¦‚ä½•å¤„ç†é…é¢æ£€æŸ¥çš„å¹¶å‘é—®é¢˜ï¼Ÿ**
A: ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡å’Œæ‚²è§‚é”ï¼ˆSELECT ... FOR UPDATEï¼‰ã€‚

**Q: èµ„æºç»Ÿè®¡å¦‚ä½•å®ç°ï¼Ÿ**
A: æŸ¥è¯¢ Environment è¡¨ï¼Œç»Ÿè®¡æ‰€æœ‰è¿è¡Œä¸­ç¯å¢ƒçš„èµ„æºæ€»å’Œã€‚éœ€è¦ç­‰å¾… A5 å®Œæˆ Environment å®ä½“åæ‰èƒ½å®ç°ã€‚

**Q: é…é¢æ£€æŸ¥å¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ**
A: è¿”å›è‡ªå®šä¹‰é”™è¯¯ï¼ŒåŒ…å«è¯¦ç»†ä¿¡æ¯ï¼Œè®©è°ƒç”¨æ–¹å†³å®šå¦‚ä½•å¤„ç†ã€‚

---

## ğŸ“ è”ç³»æ–¹å¼

### é‡åˆ°é—®é¢˜æ—¶

1. **æŠ€æœ¯é—®é¢˜**: åœ¨å›¢é˜Ÿç¾¤ä¸­æé—®
2. **é˜»å¡é—®é¢˜**: ç«‹å³é€šçŸ¥é¡¹ç›®ç»ç†
3. **ä¾èµ–é—®é¢˜**:
   - ç­‰å¾… A1: ç›´æ¥è”ç³» A1
   - é€šçŸ¥ A6: å®Œæˆåç«‹å³é€šçŸ¥

### æ¯æ—¥ç«™ä¼š

- **æ—¶é—´**: æ¯å¤©ä¸Šåˆ 10:00
- **æ—¶é•¿**: 15 åˆ†é’Ÿ
- **å†…å®¹**: æ˜¨å¤©å®Œæˆã€ä»Šå¤©è®¡åˆ’ã€é‡åˆ°çš„é—®é¢˜

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡
- [ ] æ‰€æœ‰ä»£ç é€šè¿‡ `go fmt`
- [ ] æ‰€æœ‰ä»£ç é€šè¿‡ `go vet`
- [ ] æ‰€æœ‰å…¬å¼€æ–¹æ³•æœ‰æ³¨é‡Š
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### æµ‹è¯•è´¨é‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] é…é¢æ£€æŸ¥é€»è¾‘æµ‹è¯•å……åˆ†

### æ–‡æ¡£
- [ ] ä»£ç æ³¨é‡Šå®Œæ•´
- [ ] API æ–‡æ¡£æ›´æ–°
- [ ] é…é¢æ£€æŸ¥é€»è¾‘æ–‡æ¡£

### æäº¤
- [ ] æ‰€æœ‰ä»£ç å·²æäº¤
- [ ] Pull Request å·²åˆ›å»º
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] å·²åˆå¹¶åˆ° dev åˆ†æ”¯

### é€šçŸ¥
- [ ] å·²é€šçŸ¥ A6ï¼ˆEnvironment é€»è¾‘ï¼‰
- [ ] å·²æ›´æ–°è¿›åº¦æ–‡æ¡£

---

## ğŸ’¡ å®ç°æç¤º

### é…é¢æ£€æŸ¥ç¤ºä¾‹ä»£ç 

```go
// CheckQuota æ£€æŸ¥èµ„æºé…é¢æ˜¯å¦è¶³å¤Ÿ
func (s *ResourceQuotaService) CheckQuota(customerID uint, workspaceID *uint, request *ResourceRequest) (bool, error) {
    // 1. è·å–é…é¢
    quota, err := s.GetQuota(customerID, workspaceID)
    if err != nil {
        return false, err
    }

    // 2. è·å–å·²ä½¿ç”¨èµ„æº
    used, err := s.GetUsedResources(customerID, workspaceID)
    if err != nil {
        return false, err
    }

    // 3. è®¡ç®—å¯ç”¨é…é¢
    available := &ResourceQuota{
        CPU:     quota.CPU - used.CPU,
        Memory:  quota.Memory - used.Memory,
        GPU:     quota.GPU - used.GPU,
        Storage: quota.Storage - used.Storage,
    }

    // 4. æ£€æŸ¥æ˜¯å¦è¶³å¤Ÿ
    if request.CPU > available.CPU {
        return false, fmt.Errorf("CPU é…é¢ä¸è¶³: éœ€è¦ %d, å¯ç”¨ %d", request.CPU, available.CPU)
    }
    // ... æ£€æŸ¥å…¶ä»–èµ„æº

    return true, nil
}
```

### èµ„æºç»Ÿè®¡ç¤ºä¾‹ä»£ç 

```go
// GetUsedResources è·å–å·²ä½¿ç”¨çš„èµ„æº
func (s *ResourceQuotaService) GetUsedResources(customerID uint, workspaceID *uint) (*UsedResources, error) {
    // æŸ¥è¯¢æ‰€æœ‰è¿è¡Œä¸­çš„ç¯å¢ƒ
    var environments []*entity.Environment
    query := s.db.Where("customer_id = ? AND status = ?", customerID, "running")
    if workspaceID != nil {
        query = query.Where("workspace_id = ?", *workspaceID)
    }
    if err := query.Find(&environments).Error; err != nil {
        return nil, err
    }

    // ç»Ÿè®¡èµ„æº
    used := &UsedResources{}
    for _, env := range environments {
        used.CPU += env.CPU
        used.Memory += env.Memory
        used.GPU += len(env.GPUIDs)
        used.Storage += env.Storage
    }

    return used, nil
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2026-01-30
**æœ€åæ›´æ–°**: 2026-01-30
