# GPU/NPU 云平台功能需求清单

> 基于趋动云（VirtAI Cloud）平台深度分析
>
> 分析日期：2026-01-26
>
> 参考文档：[VirtAI Cloud 平台分析报告](./docs/virtai_cloud_analysis.md)

---

## 目录

1. [核心架构设计](#1-核心架构设计)
2. [用户系统与权限管理](#2-用户系统与权限管理)
3. [资源管理系统](#3-资源管理系统)
4. [开发环境](#4-开发环境)
5. [训练系统](#5-训练系统)
6. [推理服务](#6-推理服务)
7. [数据与模型管理](#7-数据与模型管理)
8. [镜像管理](#8-镜像管理)
9. [计费系统](#9-计费系统)
10. [监控与日志](#10-监控与日志)
11. [安全与网络](#11-安全与网络)
12. [运维管理](#12-运维管理)

---

## 1. 核心架构设计

### 1.1 多租户架构

**必须实现：**
- [ ] **工作空间（Workspace）管理**
  - 创建/删除/编辑工作空间
  - 工作空间成员管理
  - 工作空间配额管理
  - 独立计费单元

- [ ] **项目组织架构**
  ```
  工作空间 (Workspace)
  ├── 项目 (Project)
  │   ├── 项目代码 (Code)
  │   ├── 开发环境 (Dev Environment)
  │   ├── 离线训练 (Training)
  │   └── 推理服务 (Inference)
  ├── 数据集 (Datasets)
  ├── 模型库 (Models)
  └── 镜像库 (Images)
  ```

- [ ] **层级权限系统**
  - 工作空间所有者（Owner）：完全管理权限
  - 工作空间管理员（Admin）：管理成员和资源
  - 普通成员（Member）：使用资源和创建项目

### 1.2 技术栈建议

**前端：**
- React/Vue 3 + TypeScript
- Ant Design / Element Plus（UI 组件库）
- Monaco Editor（代码编辑器）
- xterm.js（Web 终端）

**后端：**
- Go/Python（API Gateway）
- Node.js（实时通信）
- gRPC（内部服务通信）

**调度层：**
- Kubernetes + GPU Operator
- 自研 GPU/NPU 虚拟化引擎（对标 OrionX）

**存储：**
- Ceph/MinIO（对象存储）
- PostgreSQL（关系数据库）
- Redis（缓存和队列）

**监控：**
- Prometheus + Grafana
- DCGM（GPU 监控）
- ELK Stack（日志）

---

## 2. 用户系统与权限管理

### 2.1 用户认证

- [ ] **账户管理**
  - 用户注册/登录/登出
  - 邮箱/手机验证
  - 密码重置
  - 第三方登录（可选：GitHub, Google）

- [ ] **身份认证**
  - JWT Token 机制
  - Session 管理
  - SSH 密钥管理
  - API Key 管理

### 2.2 权限控制

- [ ] **RBAC 权限模型**
  - 角色定义（Owner, Admin, Member）
  - 资源权限控制
  - 操作权限控制

- [ ] **资源可见性**
  - 公开（Public）
  - 工作空间内共享（Workspace）
  - 私有（Private）

---

## 3. 资源管理系统

### 3.1 GPU/NPU 资源池

- [ ] **资源池管理**
  - GPU/NPU 节点注册
  - 资源状态监控（在线/离线/故障）
  - 资源分类（B/S/P 版本）
  - 多云资源调度（跨数据中心）

- [ ] **虚拟化层（核心竞争力）**
  - GPU Over IP/IB 实现
  - 动态资源分配/释放
  - 细粒度切分（vGPU）
  - 秒级资源切换
  - 性能损耗 <5%

### 3.2 资源调度

- [ ] **调度策略**
  - 配额管理（工作空间配额 + 个人配额）
  - 任务队列系统
    - 配额队列（等待配额释放）
    - 资源队列（等待资源释放）
  - 优先级调度
  - 负载均衡

- [ ] **资源配置**
  - CPU/内存/GPU 配置
  - 存储配置
  - 网络配置
  - 跨云优化提示

### 3.3 资源规格

- [ ] **GPU 版本分类**
  - B 版本（Basic）：基础算力
  - S 版本（Standard）：标准算力
  - P 版本（Premium）：高级算力
  - 同等级内数字越大性能越强

- [ ] **预设规格模板**
  - 开发环境规格（小配置）
  - 训练环境规格（中/大配置）
  - 推理服务规格（按需配置）

---

## 4. 开发环境

### 4.1 在线开发工具

- [ ] **JupyterLab 集成**
  - 启动/停止 JupyterLab
  - 默认工作目录：`/gemini/code/`
  - Notebook 文件管理
  - 内核管理

- [ ] **Web Terminal**
  - xterm.js 实现
  - Root 权限
  - 默认目录：`/gemini/code/`
  - 会话保持机制

- [ ] **TensorBoard 可视化**
  - 启动命令：`tensorboard --logdir=/gemini/output/`
  - 实验结果对比
  - 多组实验可视化

### 4.2 远程开发

- [ ] **SSH 接入**
  - SSH 服务配置
  - 动态端口分配
  - 密码认证（5 次失败锁定 30 分钟）
  - 连接信息展示

- [ ] **IDE 支持**
  - VSCode Remote-SSH 指南
  - PyCharm Professional 指南
  - SSH 配置文件管理

- [ ] **文件传输**
  - SFTP 支持
  - SCP 支持
  - 拖拽上传/下载（Web 界面）

### 4.3 环境配置

- [ ] **依赖安装**
  - pip 包管理
    - 国内镜像源配置
    - 全局配置支持
    - requirements.txt 支持
  - apt 包管理
    - 国内镜像源配置
  - conda 环境管理（可选）

- [ ] **环境管理**
  - 启动/停止/重启环境
  - 资源配置调整
  - 环境持久化（代码目录）
  - 临时存储清理

### 4.4 后台任务执行

- [ ] **会话管理工具**
  - tmux 支持和教程
  - screen 支持和教程
  - nohup 命令支持

- [ ] **JupyterLab 终端持久化**
  - 关闭浏览器后继续运行
  - 多终端管理

---

## 5. 训练系统

### 5.1 离线训练

- [ ] **任务提交**
  - 单机训练
  - 分布式多机多卡训练
  - 任务配置界面
    - 镜像选择
    - 资源规格选择
    - 数据集挂载（最多 3 个）
    - 模型挂载（最多 3 个）
    - 启动命令配置
    - 环境变量配置

- [ ] **分布式训练支持**
  - Horovod 框架
  - PyTorch DDP
  - TensorFlow Distributed
  - 自定义分布式任务
  - 多角色任务支持

- [ ] **任务管理**
  - 任务启动/停止/删除
  - 任务状态监控（排队/运行/完成/失败）
  - 任务日志查看
  - 任务重试机制

### 5.2 训练结果管理

- [ ] **输出持久化**
  - 训练结果保存到 `/gemini/output/`
  - 自动版本管理
  - 结果下载

- [ ] **实验管理**
  - TensorBoard 日志集成
  - 实验对比分析
  - 超参数记录

---

## 6. 推理服务

### 6.1 服务部署

- [ ] **推理服务创建**
  - 模型选择
  - 镜像选择
  - 资源配置
  - 副本数量配置
  - 环境变量配置

- [ ] **服务管理**
  - 启动/停止/删除服务
  - 服务升级
  - 服务回滚
  - 自动扩缩容（可选）

### 6.2 服务访问

- [ ] **端口管理**
  - 添加/删除端口
  - 外部端口自动分配（约 1 分钟）
  - 端口生命周期管理（48 小时不活动释放）
  - 开放端口使用协议签署

- [ ] **访问控制**
  - HTTP/HTTPS 协议支持
  - 外部访问地址生成
  - 访问日志记录

### 6.3 服务监控

- [ ] **健康检查**
  - 服务状态监控
  - 自动重启机制

- [ ] **性能监控**
  - QPS 监控
  - 响应时间监控
  - 错误率监控

---

## 7. 数据与模型管理

### 7.1 数据集管理

- [ ] **数据集创建**
  - 数据集信息（名称/描述/标签）
  - 可见性设置（公开/工作空间/私有）
  - 版本管理

- [ ] **数据上传**
  - Web 上传
    - 单文件最大 2GB
    - 每次最多 50 个文件
    - 支持格式：tar, zip, tar.gz, rar
  - SFTP 传输
    - 适用于 >2GB 文件
    - 连接凭证生成
    - 断点续传支持
  - 文件操作
    - 解压/删除/重命名
    - 文件浏览器

- [ ] **数据使用**
  - 数据集挂载（最多 3 个）
  - 挂载路径：`/gemini/data-1/`, `/gemini/data-2/`, `/gemini/data-3/`
  - 只读权限
  - 跨云同步指示器

### 7.2 模型管理

- [ ] **模型库功能**
  - 模型创建/上传/删除
  - 模型信息管理
  - 模型版本管理
  - 预训练模型集成

- [ ] **模型使用**
  - 模型挂载（最多 3 个）
  - 挂载路径：`/gemini/pretrain1/`, `/gemini/pretrain2/`, `/gemini/pretrain3/`
  - 只读权限

### 7.3 存储管理

- [ ] **存储配额**
  - 免费存储额度：50GB
  - 存储使用量监控
  - 存储清理提醒

- [ ] **文件系统**
  - 代码目录：`/gemini/code/`（读写，持久化）
  - 数据目录：`/gemini/data-*/`（只读）
  - 模型目录：`/gemini/pretrain*/`（只读）
  - 输出目录：`/gemini/output/`（持久化）

---

## 8. 镜像管理

### 8.1 官方镜像

- [ ] **预配置镜像库**
  - Ubuntu 18.04 + Python 3.6
  - Ubuntu 20.04 + Python 3.8（推荐）
  - Ubuntu 22.04 + Python 3.10（不推荐）
  - PyTorch 系列镜像
  - TensorFlow 系列镜像
  - 预装软件：CUDA, NCCL, numpy, pip, apt

### 8.2 自定义镜像

- [ ] **Dockerfile 支持**
  - 在线 Dockerfile 编辑器
  - 镜像构建服务
  - 构建日志查看
  - 构建历史记录

- [ ] **Dockerfile 限制**
  - 禁止指令：FROM, EXPOSE, CMD, ENTRYPOINT
  - 支持指令：ENV, RUN, COPY, ADD, WORKDIR
  - 镜像优化提示
    - 合并 RUN 指令
    - 清理 apt 缓存
    - pip `--no-cache-dir`

- [ ] **镜像管理**
  - 镜像版本管理
  - 镜像标签管理
  - 镜像大小监控
  - 镜像共享（公开/工作空间/私有）

---

## 9. 计费系统

### 9.1 计费模型

- [ ] **按量付费**
  - 工作空间维度计费
  - 1 算力点 = 1 人民币
  - 分钟级计费（向上取整）
  - 每小时扣费一次

### 9.2 计费项目

- [ ] **资源计费**
  - 开发环境计费
    - CPU/内存/GPU/显存/临时存储
  - 离线训练计费
    - 资源规格费用
    - 持久化存储费用
  - 推理服务计费
    - 按副本实例收费
  - 可视化任务计费
    - CPU 和内存

- [ ] **存储计费**
  - 持久化存储定价
    - 单价：0.003333 算力点/GB/天
    - 免费额度：50GB
    - 每日午夜扣费
    - 日平均值计算（每小时采样）

### 9.3 账户管理

- [ ] **充值系统**
  - 在线充值接口
  - 支付宝/微信支付
  - 充值记录

- [ ] **费用查询**
  - 实时余额显示
  - 费用账单查看
  - 账单明细下载
  - 资源定价展示

- [ ] **发票管理**
  - 发票申请
  - 发票记录查询

- [ ] **欠费处理**
  - 余额不足提醒
  - 欠费后任务停止（下一个小时边界）
  - 数据删除警告（欠费 60 天后）

---

## 10. 监控与日志

### 10.1 资源监控

- [ ] **实时监控**
  - CPU 使用率
  - 内存使用率
  - GPU 使用率
  - GPU 显存使用
  - GPU 温度
  - 磁盘 I/O
  - 网络 I/O

- [ ] **监控展示**
  - Dashboard 仪表盘
  - 实时图表（Grafana）
  - 历史数据查询
  - 资源使用趋势

### 10.2 任务日志

- [ ] **日志系统**
  - 任务标准输出日志
  - 任务错误日志
  - 系统日志
  - 日志搜索和过滤
  - 日志下载

- [ ] **审计日志**
  - 用户操作记录
  - 资源变更记录
  - 计费记录

### 10.3 告警系统

- [ ] **告警配置**
  - 资源使用告警（CPU/内存/GPU 超阈值）
  - 余额不足告警
  - 任务失败告警
  - 存储超额告警

- [ ] **告警通知**
  - 邮件通知
  - 短信通知（可选）
  - 站内消息

---

## 11. 安全与网络

### 11.1 网络安全

- [ ] **网络隔离**
  - VPC 隔离
  - 容器网络隔离
  - 安全组规则

- [ ] **访问控制**
  - IP 白名单（可选）
  - SSH 访问限制
  - API 访问限制

- [ ] **数据安全**
  - 数据加密存储
  - 传输加密（HTTPS/SSH）
  - 备份机制

### 11.2 网络配置

- [ ] **SSH 服务**
  - SSH 服务器配置
  - 动态端口映射
  - SSH 密码管理
  - 连接信息生成

- [ ] **外部访问**
  - 推理服务外部端口
  - HTTP/HTTPS 支持
  - 域名管理

- [ ] **网络限制**
  - 国际网络访问限制
  - 镜像源优化提示

---

## 12. 运维管理

### 12.1 平台管理

- [ ] **节点管理**
  - GPU/NPU 节点注册
  - 节点状态监控
  - 节点维护模式
  - 节点下线/上线

- [ ] **配额管理**
  - 工作空间配额设置
  - 个人配额设置
  - 配额使用监控

- [ ] **资源池管理**
  - 资源池创建/删除
  - 资源池状态监控
  - 跨云资源调度

### 12.2 系统配置

- [ ] **平台设置**
  - 镜像源配置
    - pip 镜像源
    - apt 镜像源
  - 系统参数配置
  - 定价策略配置

- [ ] **用户管理**
  - 用户列表查看
  - 用户状态管理（启用/禁用）
  - 用户配额调整

### 12.3 数据管理

- [ ] **数据备份**
  - 定期备份策略
  - 备份恢复功能

- [ ] **数据清理**
  - 过期数据清理
  - 存储优化

---

## 13. 最佳实践和文档

### 13.1 帮助文档

- [ ] **用户文档**
  - 快速开始指南
  - 操作指南
  - 常见问题 FAQ
  - 异常处理指南
  - 最佳实践

- [ ] **技术参考**
  - API 文档
  - SDK 文档
  - CLI 工具文档
  - 目录结构说明

### 13.2 交互式教程

- [ ] **新手引导**
  - 创建项目引导
  - 上传数据引导
  - 启动环境引导
  - 提交训练引导

- [ ] **视频教程**
  - 平台介绍视频
  - 功能演示视频
  - 最佳实践视频

---

## 14. 高级特性（差异化竞争）

### 14.1 GPU/NPU 池化技术

- [ ] **OrionX 虚拟化引擎**
  - GPU Over IP/IB 协议实现
  - 动态资源分配算法
  - 细粒度资源切分
  - 秒级资源切换
  - 性能优化（损耗 <5%）

### 14.2 智能调度

- [ ] **智能资源推荐**
  - 根据任务特征推荐资源配置
  - 成本优化建议
  - 跨云调度优化

- [ ] **自动扩缩容**
  - 推理服务自动扩缩容
  - 基于负载的动态调整

### 14.3 国产芯片支持

- [ ] **NPU 支持**
  - 华为昇腾 NPU
  - 寒武纪 NPU
  - 其他国产 NPU

- [ ] **NPU 优化镜像**
  - NPU 专属框架镜像
  - NPU 优化教程

---

## 15. 开发优先级建议

### MVP（最小可行产品）- 第一阶段（3 个月）

**核心功能：**
1. ✅ 用户注册/登录系统
2. ✅ 工作空间和项目管理
3. ✅ 开发环境（JupyterLab + SSH）
4. ✅ 数据上传/管理（Web + SFTP）
5. ✅ 官方镜像库
6. ✅ GPU 资源调度（Kubernetes + GPU Operator）
7. ✅ 离线训练任务提交
8. ✅ 基础监控（GPU 使用率/温度）
9. ✅ 秒级计费系统
10. ✅ 基础文档和帮助

### 第二阶段（6 个月）- 核心竞争力

**虚拟化和优化：**
1. ✅ NPU 虚拟化引擎（OrionX for NPU）
2. ✅ 秒级资源切换功能
3. ✅ 跨节点资源调度
4. ✅ 自定义镜像构建
5. ✅ 推理服务部署
6. ✅ TensorBoard 集成
7. ✅ 完善的监控和告警
8. ✅ 成本优化工具

### 第三阶段（9 个月）- 企业功能

**企业级能力：**
1. ✅ 多租户配额管理
2. ✅ 任务队列优先级
3. ✅ 分布式训练支持
4. ✅ 私有云部署方案
5. ✅ API 和 SDK
6. ✅ 智能调度和推荐
7. ✅ 数据备份和恢复
8. ✅ 审计日志和合规

---

## 16. 关键技术指标

### 16.1 性能指标

- [ ] **系统性能**
  - API 响应时间 <200ms
  - 任务启动时间 <1 分钟
  - 资源切换时间 <10 秒
  - 页面加载时间 <2 秒

- [ ] **虚拟化性能**
  - GPU 虚拟化性能损耗 <5%
  - 网络延迟 <10ms
  - 存储 I/O 性能接近原生

### 16.2 可靠性指标

- [ ] **系统可用性**
  - 服务可用性 >99.9%
  - 数据持久性 >99.999%
  - 故障恢复时间 <30 分钟

### 16.3 安全指标

- [ ] **安全合规**
  - ISO 27001 认证
  - 数据加密（静态 + 传输）
  - 定期安全审计
  - 漏洞修复 SLA

---

## 17. 技术栈总结

### 17.1 前端技术栈

```
前端框架：React 18 + TypeScript
状态管理：Redux Toolkit / Zustand
UI 库：Ant Design / Chakra UI
图表：ECharts / Recharts
编辑器：Monaco Editor
终端：xterm.js
构建工具：Vite
```

### 17.2 后端技术栈

```
API 网关：Go (Gin) / Python (FastAPI)
实时通信：Node.js (Socket.io)
任务队列：Redis + Bull/Celery
数据库：PostgreSQL + Redis
对象存储：MinIO / Ceph
消息队列：RabbitMQ / Kafka
```

### 17.3 基础设施

```
容器编排：Kubernetes 1.28+
GPU 管理：NVIDIA GPU Operator / 自研 NPU Operator
监控：Prometheus + Grafana + DCGM
日志：ELK Stack (Elasticsearch + Logstash + Kibana)
追踪：Jaeger (可选)
服务网格：Istio (可选)
```

### 17.4 开发工具

```
版本控制：Git + GitLab/GitHub
CI/CD：GitLab CI / GitHub Actions
容器化：Docker + Docker Compose
IaC：Terraform / Ansible
文档：Docusaurus / VuePress
```

---

## 18. 对比分析总结

### 趋动云核心优势（值得借鉴）

1. **GPU 池化技术**：OrionX 虚拟化引擎，秒级切换，动态分配
2. **成本优势**：节省 60-70% 成本
3. **完整工作流**：从数据准备到模型部署的全流程
4. **企业管理**：多租户、配额管理、团队协作
5. **用户体验**：预配置镜像、零门槛分布式训练

### 我们的差异化方向

1. **国产 NPU 优先支持**：华为昇腾、寒武纪等
2. **NPU 虚拟化技术**：自研 NPU 池化引擎
3. **私有云方案**：企业本地部署能力
4. **成本优化**：更激进的定价策略
5. **国产替代政策红利**：政府和企业市场

---

## 附录

### A. 文件命名和限制规范

- 文件名：1-64 个字符，不含 `/`
- 压缩格式：tar, zip, tar.gz, rar
- Web 上传：单文件 <2GB，每次 <50 个文件
- 项目名称：<64 个字符，工作空间内唯一
- 数据集挂载：最多 3 个
- 模型挂载：最多 3 个

### B. 目录结构规范

```
/gemini/
├── code/               # 可读写，持久化
├── data-1/             # 只读
├── data-2/             # 只读
├── data-3/             # 只读
├── pretrain1/          # 只读
├── pretrain2/          # 只读
├── pretrain3/          # 只读
└── output/             # 持久化
```

### C. 镜像源配置

**pip：**
```bash
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

**apt：**
编辑 `/etc/apt/sources.list` 使用国内镜像

### D. 参考链接

- [VirtAI Cloud 文档](https://platform.virtaicloud.com/gemini/v1/gemini_doc/)
- [趋动科技官网](https://virtaitech.com/)
- [OrionX GitHub](https://github.com/virtaitech/orion)

---

**文档结束**

*本需求文档基于趋动云平台深度分析生成，包含完整的功能清单和技术实现建议。*
