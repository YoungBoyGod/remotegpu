# 开发环境创建与管理

> 所属模块：模块 3 - 环境管理模块
>
> 功能编号：3.1
>
> 优先级：P0（必须）

---

## 1. 功能概述

### 1.1 功能描述

开发环境创建与管理功能允许用户快速创建隔离的开发环境，支持 Linux 和 Windows 双平台，提供 SSH/RDP 访问方式，支持 GPU 资源分配，为用户提供完整的开发工作空间。

### 1.2 业务价值

- ✅ 快速创建开发环境（< 2 分钟）
- ✅ 环境隔离，互不干扰
- ✅ 灵活的资源配置（CPU、内存、GPU）
- ✅ 支持多种镜像（PyTorch、TensorFlow、CUDA）

---

## 2. 核心功能

### 2.1 环境创建流程

```yaml
创建流程:
  1. 用户提交创建请求:
     - 选择镜像（ubuntu20-pytorch:2.0）
     - 配置资源（4 CPU, 16GB 内存, 1 GPU）
     - 选择数据集（可选）

  2. 系统调度:
     - 调度器选择合适的主机
     - 分配 GPU 资源
     - 分配 SSH 端口

  3. 环境创建:
     - 创建 Docker 容器（Linux）
     - 创建 Windows 用户（Windows）
     - 挂载数据集
     - 配置网络

  4. 返回访问信息:
     - SSH 地址和端口
     - 用户名和密码
     - JupyterLab 地址（如果启用）
```

### 2.2 支持的镜像类型

| 镜像名称 | 基础系统 | 深度学习框架 | CUDA 版本 |
|---------|---------|-------------|----------|
| ubuntu20-pytorch:2.0 | Ubuntu 20.04 | PyTorch 2.0 | 11.8 |
| ubuntu20-tensorflow:2.12 | Ubuntu 20.04 | TensorFlow 2.12 | 11.8 |
| ubuntu22-cuda:12.0 | Ubuntu 22.04 | - | 12.0 |
| windows-server:2022 | Windows Server 2022 | - | 11.8 |

---

## 3. API 接口

### 3.1 创建环境

```go
POST /api/environments
Body: {
  "name": "PyTorch Training",
  "image": "ubuntu20-pytorch:2.0",
  "resources": {
    "cpu": 4,
    "memory": 17179869184,  // 16GB in bytes
    "gpu": 1
  },
  "datasets": ["dataset-123"],
  "enable_jupyter": true
}

Response: {
  "env_id": "env-abc123",
  "status": "creating",
  "ssh_host": "gateway.example.com",
  "ssh_port": 30001,
  "ssh_username": "developer",
  "ssh_password": "generated_password",
  "jupyter_url": "https://gateway.example.com:38001"
}
```

### 3.2 查询环境状态

```go
GET /api/environments/:id

Response: {
  "env_id": "env-abc123",
  "name": "PyTorch Training",
  "status": "running",
  "host_id": "host-xyz789",
  "resources": {
    "cpu": 4,
    "memory": 17179869184,
    "gpu": 1
  },
  "created_at": "2026-01-26T10:00:00Z",
  "uptime": 3600
}
```

---

## 4. 数据模型

```sql
CREATE TABLE environments (
    id VARCHAR(64) PRIMARY KEY,
    customer_id BIGINT NOT NULL,
    host_id VARCHAR(64) NOT NULL,
    name VARCHAR(128) NOT NULL,
    image VARCHAR(256) NOT NULL,
    status VARCHAR(20) DEFAULT 'creating',

    -- 资源配置
    cpu INT NOT NULL,
    memory BIGINT NOT NULL,
    gpu INT DEFAULT 0,

    -- 访问信息
    ssh_port INT,
    ssh_username VARCHAR(128),
    ssh_password VARCHAR(128),

    -- 容器信息
    container_id VARCHAR(128),

    created_at TIMESTAMP DEFAULT NOW(),

    FOREIGN KEY (customer_id) REFERENCES customers(id),
    FOREIGN KEY (host_id) REFERENCES hosts(id)
);
```

---

## 5. 前端界面

### 5.1 创建环境页面

```vue
<template>
  <el-form :model="form">
    <el-form-item label="环境名称">
      <el-input v-model="form.name" />
    </el-form-item>

    <el-form-item label="镜像">
      <el-select v-model="form.image">
        <el-option
          label="Ubuntu 20.04 + PyTorch 2.0"
          value="ubuntu20-pytorch:2.0"
        />
        <el-option
          label="Ubuntu 20.04 + TensorFlow 2.12"
          value="ubuntu20-tensorflow:2.12"
        />
      </el-select>
    </el-form-item>

    <el-form-item label="CPU 核心数">
      <el-input-number v-model="form.cpu" :min="1" :max="64" />
    </el-form-item>

    <el-form-item label="内存 (GB)">
      <el-input-number v-model="form.memory" :min="1" :max="512" />
    </el-form-item>

    <el-form-item label="GPU 数量">
      <el-input-number v-model="form.gpu" :min="0" :max="8" />
    </el-form-item>

    <el-button type="primary" @click="createEnvironment">
      创建环境
    </el-button>
  </el-form>
</template>
```

---

## 6. 测试用例

| 用例 | 场景 | 预期结果 |
|------|------|---------|
| TC-01 | 创建 Linux 环境 | 2 分钟内创建成功 |
| TC-02 | 创建 Windows 环境 | 3 分钟内创建成功 |
| TC-03 | 资源不足 | 返回错误提示 |
| TC-04 | SSH 连接 | 可以正常连接 |

---

**文档版本：** v1.0
**创建日期：** 2026-01-26
