groups:
  - name: app_alerts
    rules:
      # API 高错误率
      - alert: HighApiErrorRate
        expr: sum(rate(http_requests_total{status=~"5.."}[5m])) / sum(rate(http_requests_total[5m])) > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API 5xx 错误率过高"
          description: "5xx 错误率超过 5%，当前值: {{ $value | printf \"%.2f\" }}"

      # PostgreSQL 连接数过高
      - alert: PostgresqlTooManyConnections
        expr: pg_stat_activity_count > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "PostgreSQL 连接数过高"
          description: "当前活跃连接数: {{ $value }}"

      # Redis 内存使用过高
      - alert: RedisHighMemoryUsage
        expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis 内存使用率过高"
          description: "Redis 内存使用超过 80%"
